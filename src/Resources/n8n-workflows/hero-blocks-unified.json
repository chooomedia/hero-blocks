{
    "nodes": [
        {
            "parameters": {
                "jsCode": "// ============================================================================\n// UNIVERSAL SLACK BLOCK BUILDER - Alle Block-Typen mit vollstÃ¤ndiger Konfiguration\n// ============================================================================\n// Best Practices: Slack Blocks API - Alle Block-Typen unterstÃ¼tzt\n// Referenz: https://api.slack.com/reference/block-kit/blocks\n// Block Kit Builder: https://app.slack.com/block-kit-builder\n// n8n Slack Node: https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack/\n// ============================================================================\n\n/**\n * UNIVERSAL SLACK BLOCK BUILDER\n * Erstellt alle Slack Block-Typen mit vollstÃ¤ndiger Konfiguration\n * \n * UnterstÃ¼tzte Block-Typen:\n * - header: Header-Block mit Text\n * - section: Section-Block mit Text, Fields, Accessory (Button, Image, etc.)\n * - divider: Trennlinie\n * - actions: Actions-Block mit Buttons, Select Menus, etc.\n * - context: Context-Block fÃ¼r Footer-Informationen\n * - image: Image-Block fÃ¼r Bilder\n * - input: Input-Block fÃ¼r Formulare\n * - file: File-Block fÃ¼r Dateien\n * - video: Video-Block fÃ¼r Videos\n * - rich_text: Rich Text Block (experimental)\n * \n * @param {Object} config - Konfigurationsobjekt fÃ¼r Block-Erstellung\n * @returns {Array} Array von Slack Blocks\n */\nconst SlackBlockBuilder = {\n  // Header Block - Titel-Block mit Text\n  header: (text, emoji = true) => ({\n    type: 'header',\n    text: {\n      type: 'plain_text',\n      text: text,\n      emoji: emoji\n    }\n  }),\n  \n  // Divider Block - Trennlinie\n  divider: () => ({ type: 'divider' }),\n  \n  // Section Block - Hauptinhalt mit Text, Fields, Accessory\n  section: (config = {}) => {\n    const block = { type: 'section' };\n    \n    // Text (mrkdwn oder plain_text)\n    if (config.text) {\n      block.text = {\n        type: config.textType || 'mrkdwn',\n        text: config.text,\n        verbatim: config.verbatim || false\n      };\n    }\n    \n    // Fields (2-spaltig kompakt)\n    if (config.fields && Array.isArray(config.fields)) {\n      block.fields = config.fields.map(field => ({\n        type: field.type || 'mrkdwn',\n        text: field.text || field,\n        verbatim: field.verbatim || false\n      }));\n    }\n    \n    // Accessory (Button, Image, Select Menu, etc.)\n    if (config.accessory) {\n      block.accessory = config.accessory;\n    }\n    \n    return block;\n  },\n  \n  // Actions Block - Interaktive Elemente (Buttons, Select Menus, etc.)\n  actions: (elements = []) => ({\n    type: 'actions',\n    elements: elements\n  }),\n  \n  // Button Element - FÃ¼r Actions Block\n  button: (config = {}) => {\n    const button = {\n      type: 'button',\n      text: {\n        type: 'plain_text',\n        text: config.text || 'Button',\n        emoji: config.emoji !== false\n      },\n      action_id: config.actionId || config.action_id || 'button_click'\n    };\n    \n    // Style (primary, danger)\n    if (config.style) {\n      button.style = config.style;\n    }\n    \n    // URL (fÃ¼r externe Links)\n    if (config.url) {\n      button.url = config.url;\n    }\n    \n    // Value (fÃ¼r Button-Click-Handler)\n    if (config.value) {\n      button.value = config.value;\n    }\n    \n    // Confirm Dialog (optional)\n    if (config.confirm) {\n      button.confirm = config.confirm;\n    }\n    \n    return button;\n  },\n  \n  // Context Block - Footer-Informationen\n  context: (elements = []) => ({\n    type: 'context',\n    elements: Array.isArray(elements) ? elements.map(el => ({\n      type: el.type || 'mrkdwn',\n      text: el.text || el,\n      verbatim: el.verbatim || false\n    })) : [{\n      type: 'mrkdwn',\n      text: elements\n    }]\n  }),\n  \n  // Image Block - Bild-Block\n  image: (config = {}) => ({\n    type: 'image',\n    image_url: config.imageUrl || config.url,\n    alt_text: config.altText || config.alt || 'Image',\n    title: config.title ? {\n      type: 'plain_text',\n      text: config.title,\n      emoji: config.emoji !== false\n    } : undefined\n  }),\n  \n  // Input Block - Formular-Eingabefeld (fÃ¼r Modals)\n  input: (config = {}) => {\n    const block = {\n      type: 'input',\n      block_id: config.blockId || config.block_id,\n      label: {\n        type: 'plain_text',\n        text: config.label || 'Label',\n        emoji: config.emoji !== false\n      },\n      element: config.element || {},\n      hint: config.hint ? {\n        type: 'plain_text',\n        text: config.hint\n      } : undefined,\n      optional: config.optional || false\n    };\n    \n    return block;\n  },\n  \n  // File Block - Datei-Block\n  file: (config = {}) => ({\n    type: 'file',\n    external_id: config.externalId || config.external_id,\n    source: config.source || 'remote',\n    block_id: config.blockId || config.block_id\n  }),\n  \n  // Video Block - Video-Block\n  video: (config = {}) => ({\n    type: 'video',\n    video_url: config.videoUrl || config.url,\n    thumbnail_url: config.thumbnailUrl || config.thumbnail,\n    alt_text: config.altText || config.alt || 'Video',\n    title: config.title ? {\n      type: 'plain_text',\n      text: config.title,\n      emoji: config.emoji !== false\n    } : undefined,\n    author_name: config.authorName || config.author,\n    description: config.description ? {\n      type: 'plain_text',\n      text: config.description\n    } : undefined,\n    title_url: config.titleUrl || config.title_url,\n    provider_icon_url: config.providerIconUrl || config.providerIcon,\n    provider_name: config.providerName || config.provider\n  }),\n  \n  // Rich Text Block - Rich Text Block (experimental)\n  richText: (config = {}) => ({\n    type: 'rich_text',\n    block_id: config.blockId || config.block_id,\n    elements: config.elements || []\n  }),\n  \n  // Helper: Erstelle Field fÃ¼r Section (kompakt)\n  field: (label, value, type = 'mrkdwn') => ({\n    type: type,\n    text: `*${label}:*\\n${value}`\n  }),\n  \n  // Helper: Erstelle Context Element (kompakt)\n  contextElement: (text, type = 'mrkdwn') => ({\n    type: type,\n    text: text\n  })\n};\n\n// ============================================================================\n// FORMAT SLACK MESSAGE - UPDATE CHECK\n// ============================================================================\n\nconst checkType = $input.item.json.checkType || 'update';\nconst currentVersion = $input.item.json.currentVersion || $input.item.json.query?.currentVersion || '1.0.0';\nconst hasError = $input.item.json.hasError === true;\nconst githubError = $input.item.json.githubError || null;\nconst available = $input.item.json.available || false;\nconst latestVersion = $input.item.json.latestVersion || currentVersion;\nconst downloadUrl = $input.item.json.downloadUrl || null;\nconst changelog = $input.item.json.changelog || null;\nconst githubReleaseUrl = $input.item.json.githubReleaseUrl || null;\nconst githubPublishedAt = $input.item.json.githubPublishedAt || null;\n\n// Generiere eindeutige Message-ID fÃ¼r Delete-Button\nconst messageId = `hero-blocks-update-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n// Formatiere Timestamp fÃ¼r Context Block\nconst formatTimestamp = (timestamp) => {\n  if (!timestamp) return null;\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleDateString('de-DE', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\n  } catch (e) {\n    return null;\n  }\n};\n\n// Bestimme Nachrichtentyp und erstelle Blocks mit Builder\nlet blocks = [];\nlet text = ''; // Fallback fÃ¼r Plain Text Clients\n\nif (hasError) {\n    // Fehler: GitHub API Fehler oder kein Release gefunden\n    text = `âš ï¸ Hero Blocks Update Check - Fehler`;\n    blocks = [\n        // Header Block (mit Builder)\n        SlackBlockBuilder.header('âš ï¸ Hero Blocks Update Check - Fehler'),\n        // Divider fÃ¼r visuelle Trennung\n        SlackBlockBuilder.divider(),\n        // Section mit Fields (2-spaltig kompakt - mit Builder)\n        SlackBlockBuilder.section({\n            fields: [\n                SlackBlockBuilder.field('Fehler', githubError || 'Unbekannter Fehler'),\n                SlackBlockBuilder.field('Aktuelle Version', currentVersion),\n                SlackBlockBuilder.field('Status', 'âŒ Kein Release gefunden'),\n                SlackBlockBuilder.field('Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n            ]\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit mÃ¶glichen Ursachen (mit Builder)\n        SlackBlockBuilder.section({\n            text: `*ğŸ” MÃ¶gliche Ursachen:*\\nâ€¢ Repository existiert nicht\\nâ€¢ Keine Releases vorhanden\\nâ€¢ GitHub API Rate Limit erreicht`\n        }),\n        // Section mit LÃ¶sungen (mit Builder)\n        SlackBlockBuilder.section({\n            text: `*ğŸ’¡ LÃ¶sung:*\\nâ€¢ PrÃ¼fe <https://github.com/chooomedia/hero-blocks/releases|GitHub Releases>\\nâ€¢ Erstelle erstes Release falls nÃ¶tig\\nâ€¢ PrÃ¼fe n8n Workflow Logs`\n        }),\n        // Actions mit Buttons (Button-Gruppe - mit Builder)\n        SlackBlockBuilder.actions([\n            SlackBlockBuilder.button({\n                text: 'ğŸ”— GitHub Ã¶ffnen',\n                style: 'primary',\n                url: 'https://github.com/chooomedia/hero-blocks/releases',\n                actionId: 'open_github'\n            }),\n            SlackBlockBuilder.button({\n                text: 'ğŸ—‘ï¸ LÃ¶schen',\n                style: 'danger',\n                actionId: 'delete_message',\n                value: messageId\n            })\n        ]),\n        // Context Block fÃ¼r Footer-Info (mit Builder)\n        SlackBlockBuilder.context([\n            SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ Version ${currentVersion}`)\n        ])\n    ];\n} else if (available) {\n    // Update verfÃ¼gbar - FANCY mit allen Features!\n    text = `âœ… Hero Blocks Update verfÃ¼gbar`;\n    const publishedDate = formatTimestamp(githubPublishedAt);\n    \n    // Erstelle Actions-Elemente dynamisch\n    const actionElements = [];\n    if (githubReleaseUrl) {\n        actionElements.push(SlackBlockBuilder.button({\n            text: 'ğŸ”— Release ansehen',\n            style: 'primary',\n            url: githubReleaseUrl,\n            actionId: 'view_release'\n        }));\n    }\n    actionElements.push(SlackBlockBuilder.button({\n        text: 'ğŸ—‘ï¸ LÃ¶schen',\n        style: 'danger',\n        actionId: 'delete_message',\n        value: messageId\n    }));\n    \n    blocks = [\n        // Header Block mit Emoji (mit Builder)\n        SlackBlockBuilder.header('ğŸš€ Hero Blocks Update verfÃ¼gbar'),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit Fields (kompaktes 2-Spalten-Layout - mit Builder)\n        SlackBlockBuilder.section({\n            fields: [\n                SlackBlockBuilder.field('ğŸ“¦ Aktuelle Version', `\\`${currentVersion}\\``),\n                SlackBlockBuilder.field('âœ¨ Neue Version', `\\`${latestVersion}\\``),\n                SlackBlockBuilder.field('ğŸ“… VerÃ¶ffentlicht', publishedDate || 'VerfÃ¼gbar'),\n                SlackBlockBuilder.field('ğŸ”– Release', `<https://github.com/chooomedia/hero-blocks/releases/tag/v${latestVersion}|v${latestVersion}>`)\n            ]\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit Download-Link (wenn verfÃ¼gbar - mit Builder)\n        ...(downloadUrl ? [SlackBlockBuilder.section({\n            text: `*ğŸ“¥ Download:*\\n<${downloadUrl}|hero-blocks-${latestVersion}.zip>`,\n            accessory: SlackBlockBuilder.button({\n                text: 'â¬‡ï¸ Download',\n                style: 'primary',\n                url: downloadUrl,\n                actionId: 'download_update'\n            })\n        })] : []),\n        // Changelog Section (falls vorhanden - mit Builder)\n        ...(changelog ? [\n            SlackBlockBuilder.divider(),\n            SlackBlockBuilder.section({\n                text: `*ğŸ“ Changelog:*\\n\\`\\`\\`${changelog.substring(0, 500)}${changelog.length > 500 ? '...' : ''}\\`\\`\\``\n            })\n        ] : []),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Actions mit Button-Gruppe (Primary + Danger - mit Builder)\n        SlackBlockBuilder.actions(actionElements),\n        // Context Block fÃ¼r Footer (Metadaten - mit Builder)\n        SlackBlockBuilder.context([\n            SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion} â†’ ${latestVersion} | <https://github.com/chooomedia/hero-blocks|Repository>`)\n        ])\n    ];\n} else {\n    // Kein Update verfÃ¼gbar - KOMPAKTE Blocks mit \"LÃ¶schen\"-Button (Best Practice: Spam-Vermeidung)\n    // WICHTIG: Als kompakte Block-Nachricht, damit User sie lÃ¶schen kÃ¶nnen\n    text = `â„¹ï¸ Hero Blocks - Kein Update verfÃ¼gbar`;\n    blocks = [\n        // Header Block (kompakt - mit Builder)\n        SlackBlockBuilder.header('â„¹ï¸ Hero Blocks - Kein Update verfÃ¼gbar'),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit kompakten Infos (2-Spalten - mit Builder)\n        SlackBlockBuilder.section({\n            fields: [\n                SlackBlockBuilder.field('ğŸ“¦ Aktuelle Version', `\\`${currentVersion}\\``),\n                SlackBlockBuilder.field('âœ¨ Neueste Version', `\\`${latestVersion}\\``),\n                SlackBlockBuilder.field('âœ… Status', 'Plugin ist aktuell'),\n                SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n            ]\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Actions mit \"LÃ¶schen\"-Button (Best Practice: User kann Nachricht sofort lÃ¶schen - mit Builder)\n        SlackBlockBuilder.actions([\n            SlackBlockBuilder.button({\n                text: 'ğŸ—‘ï¸ LÃ¶schen',\n                style: 'danger',\n                actionId: 'delete_message',\n                value: messageId\n            })\n        ]),\n        // Context Block fÃ¼r Footer (kompakt - mit Builder)\n        SlackBlockBuilder.context([\n            SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion}`)\n        ])\n    ];\n}\n\nreturn {\n    json: {\n        ...$input.item.json,\n        slackMessage: text, // Plain Text Fallback\n        slackBlocks: blocks, // Blocks API Format (null fÃ¼r Plain Text)\n        messageId: messageId // FÃ¼r Delete-Button\n    }\n};"
            },
            "id": "f6f3cece-7cc8-4871-affb-11623d51279d",
            "name": "Code (Format Slack Message - Update)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -1936,
                -432
            ]
        },
        {
            "parameters": {
                "jsCode": "// ============================================================================\n// UNIVERSAL SLACK BLOCK BUILDER - Alle Block-Typen mit vollstÃ¤ndiger Konfiguration\n// ============================================================================\n// Best Practices: Slack Blocks API - Alle Block-Typen unterstÃ¼tzt\n// Referenz: https://api.slack.com/reference/block-kit/blocks\n// Block Kit Builder: https://app.slack.com/block-kit-builder\n// n8n Slack Node: https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack/\n// ============================================================================\n\n/**\n * UNIVERSAL SLACK BLOCK BUILDER\n * Erstellt alle Slack Block-Typen mit vollstÃ¤ndiger Konfiguration\n * \n * UnterstÃ¼tzte Block-Typen:\n * - header: Header-Block mit Text\n * - section: Section-Block mit Text, Fields, Accessory (Button, Image, etc.)\n * - divider: Trennlinie\n * - actions: Actions-Block mit Buttons, Select Menus, etc.\n * - context: Context-Block fÃ¼r Footer-Informationen\n * - image: Image-Block fÃ¼r Bilder\n * - input: Input-Block fÃ¼r Formulare\n * - file: File-Block fÃ¼r Dateien\n * - video: Video-Block fÃ¼r Videos\n * - rich_text: Rich Text Block (experimental)\n * \n * @param {Object} config - Konfigurationsobjekt fÃ¼r Block-Erstellung\n * @returns {Array} Array von Slack Blocks\n */\nconst SlackBlockBuilder = {\n  // Header Block - Titel-Block mit Text\n  header: (text, emoji = true) => ({\n    type: 'header',\n    text: {\n      type: 'plain_text',\n      text: text,\n      emoji: emoji\n    }\n  }),\n  \n  // Divider Block - Trennlinie\n  divider: () => ({ type: 'divider' }),\n  \n  // Section Block - Hauptinhalt mit Text, Fields, Accessory\n  section: (config = {}) => {\n    const block = { type: 'section' };\n    \n    // Text (mrkdwn oder plain_text)\n    if (config.text) {\n      block.text = {\n        type: config.textType || 'mrkdwn',\n        text: config.text,\n        verbatim: config.verbatim || false\n      };\n    }\n    \n    // Fields (2-spaltig kompakt)\n    if (config.fields && Array.isArray(config.fields)) {\n      block.fields = config.fields.map(field => ({\n        type: field.type || 'mrkdwn',\n        text: field.text || field,\n        verbatim: field.verbatim || false\n      }));\n    }\n    \n    // Accessory (Button, Image, Select Menu, etc.)\n    if (config.accessory) {\n      block.accessory = config.accessory;\n    }\n    \n    return block;\n  },\n  \n  // Actions Block - Interaktive Elemente (Buttons, Select Menus, etc.)\n  actions: (elements = []) => ({\n    type: 'actions',\n    elements: elements\n  }),\n  \n  // Button Element - FÃ¼r Actions Block\n  button: (config = {}) => {\n    const button = {\n      type: 'button',\n      text: {\n        type: 'plain_text',\n        text: config.text || 'Button',\n        emoji: config.emoji !== false\n      },\n      action_id: config.actionId || config.action_id || 'button_click'\n    };\n    \n    // Style (primary, danger)\n    if (config.style) {\n      button.style = config.style;\n    }\n    \n    // URL (fÃ¼r externe Links)\n    if (config.url) {\n      button.url = config.url;\n    }\n    \n    // Value (fÃ¼r Button-Click-Handler)\n    if (config.value) {\n      button.value = config.value;\n    }\n    \n    // Confirm Dialog (optional)\n    if (config.confirm) {\n      button.confirm = config.confirm;\n    }\n    \n    return button;\n  },\n  \n  // Context Block - Footer-Informationen\n  context: (elements = []) => ({\n    type: 'context',\n    elements: Array.isArray(elements) ? elements.map(el => ({\n      type: el.type || 'mrkdwn',\n      text: el.text || el,\n      verbatim: el.verbatim || false\n    })) : [{\n      type: 'mrkdwn',\n      text: elements\n    }]\n  }),\n  \n  // Image Block - Bild-Block\n  image: (config = {}) => ({\n    type: 'image',\n    image_url: config.imageUrl || config.url,\n    alt_text: config.altText || config.alt || 'Image',\n    title: config.title ? {\n      type: 'plain_text',\n      text: config.title,\n      emoji: config.emoji !== false\n    } : undefined\n  }),\n  \n  // Input Block - Formular-Eingabefeld (fÃ¼r Modals)\n  input: (config = {}) => {\n    const block = {\n      type: 'input',\n      block_id: config.blockId || config.block_id,\n      label: {\n        type: 'plain_text',\n        text: config.label || 'Label',\n        emoji: config.emoji !== false\n      },\n      element: config.element || {},\n      hint: config.hint ? {\n        type: 'plain_text',\n        text: config.hint\n      } : undefined,\n      optional: config.optional || false\n    };\n    \n    return block;\n  },\n  \n  // File Block - Datei-Block\n  file: (config = {}) => ({\n    type: 'file',\n    external_id: config.externalId || config.external_id,\n    source: config.source || 'remote',\n    block_id: config.blockId || config.block_id\n  }),\n  \n  // Video Block - Video-Block\n  video: (config = {}) => ({\n    type: 'video',\n    video_url: config.videoUrl || config.url,\n    thumbnail_url: config.thumbnailUrl || config.thumbnail,\n    alt_text: config.altText || config.alt || 'Video',\n    title: config.title ? {\n      type: 'plain_text',\n      text: config.title,\n      emoji: config.emoji !== false\n    } : undefined,\n    author_name: config.authorName || config.author,\n    description: config.description ? {\n      type: 'plain_text',\n      text: config.description\n    } : undefined,\n    title_url: config.titleUrl || config.title_url,\n    provider_icon_url: config.providerIconUrl || config.providerIcon,\n    provider_name: config.providerName || config.provider\n  }),\n  \n  // Rich Text Block - Rich Text Block (experimental)\n  richText: (config = {}) => ({\n    type: 'rich_text',\n    block_id: config.blockId || config.block_id,\n    elements: config.elements || []\n  }),\n  \n  // Helper: Erstelle Field fÃ¼r Section (kompakt)\n  field: (label, value, type = 'mrkdwn') => ({\n    type: type,\n    text: `*${label}:*\\n${value}`\n  }),\n  \n  // Helper: Erstelle Context Element (kompakt)\n  contextElement: (text, type = 'mrkdwn') => ({\n    type: type,\n    text: text\n  })\n};\n\n// ============================================================================\n// FORMAT SLACK MESSAGE - LICENSE CHECK\n// ============================================================================\n\nconst checkType = $input.item.json.checkType || 'license';\nconst valid = $input.item.json.valid === true;\nconst expiresAt = $input.item.json.expiresAt || null;\nconst daysRemaining = $input.item.json.daysRemaining || 0;\nconst plugin = $input.item.json.plugin || 'hero-blocks';\nconst currentVersion = $input.item.json.currentVersion || $input.item.json.query?.currentVersion || '1.0.0';\n\n// Generiere eindeutige Message-ID fÃ¼r Delete-Button\nconst messageId = `hero-blocks-license-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n// Formatiere Ablaufdatum fÃ¼r Context Block\nconst formatExpiryDate = (timestamp) => {\n  if (!timestamp) return 'Unbekannt';\n  try {\n    const date = new Date(timestamp);\n    return date.toLocaleDateString('de-DE', { year: 'numeric', month: 'long', day: 'numeric' });\n  } catch (e) {\n    return 'Unbekannt';\n  }\n};\n\n// Bestimme Status-Emoji und -Text\nconst getStatusInfo = (isValid, days) => {\n  if (!isValid) return { emoji: 'âŒ', text: 'Abgelaufen', color: 'danger' };\n  if (days > 90) return { emoji: 'âœ…', text: 'GÃ¼ltig', color: 'good' };\n  if (days > 30) return { emoji: 'âš ï¸', text: 'LÃ¤uft bald ab', color: 'warning' };\n  return { emoji: 'ğŸš¨', text: 'LÃ¤uft sehr bald ab', color: 'danger' };\n};\n\nconst statusInfo = getStatusInfo(valid, daysRemaining);\nconst expiryDate = formatExpiryDate(expiresAt);\n\n// Bestimme Nachrichtentyp und erstelle Blocks mit Builder\nlet blocks = [];\nlet text = ''; // Fallback fÃ¼r Plain Text Clients\n\nif (valid) {\n    // License gÃ¼ltig - FANCY mit allen Features!\n    text = `âœ… Hero Blocks License Check - GÃ¼ltig`;\n    blocks = [\n        // Header Block mit Status-Emoji (mit Builder)\n        SlackBlockBuilder.header(`${statusInfo.emoji} Hero Blocks License Check - ${statusInfo.text}`),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit Fields (kompaktes 2-Spalten-Layout - mit Builder)\n        SlackBlockBuilder.section({\n            fields: [\n                SlackBlockBuilder.field('ğŸ”§ Plugin', plugin),\n                SlackBlockBuilder.field('ğŸ“¦ Version', currentVersion),\n                SlackBlockBuilder.field(`${statusInfo.emoji} Status`, statusInfo.text),\n                SlackBlockBuilder.field('ğŸ“… Ablaufdatum', expiryDate),\n                SlackBlockBuilder.field('â° Tage verbleibend', `${daysRemaining} ${daysRemaining === 1 ? 'Tag' : 'Tage'}`),\n                SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n            ]\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Actions mit Button-Gruppe (mit Builder)\n        SlackBlockBuilder.actions([\n            SlackBlockBuilder.button({\n                text: 'ğŸ”— Repository',\n                style: 'primary',\n                url: 'https://github.com/chooomedia/hero-blocks',\n                actionId: 'open_repository'\n            }),\n            SlackBlockBuilder.button({\n                text: 'ğŸ—‘ï¸ LÃ¶schen',\n                style: 'danger',\n                actionId: 'delete_message',\n                value: messageId\n            })\n        ]),\n        // Context Block fÃ¼r Footer (Metadaten - mit Builder)\n        SlackBlockBuilder.context([\n            SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion} | ${daysRemaining} Tage verbleibend`)\n        ])\n    ];\n} else {\n    // License ungÃ¼ltig - WICHTIG mit Call-to-Action!\n    text = `âš ï¸ Hero Blocks License Check - Abgelaufen`;\n    blocks = [\n        // Header Block mit Warnung (mit Builder)\n        SlackBlockBuilder.header('ğŸš¨ Hero Blocks License Check - Abgelaufen'),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit Fields (kompaktes 2-Spalten-Layout - mit Builder)\n        SlackBlockBuilder.section({\n            fields: [\n                SlackBlockBuilder.field('ğŸ”§ Plugin', plugin),\n                SlackBlockBuilder.field('ğŸ“¦ Version', currentVersion),\n                SlackBlockBuilder.field('âŒ Status', 'Abgelaufen'),\n                SlackBlockBuilder.field('ğŸ“… Ablaufdatum', expiryDate),\n                SlackBlockBuilder.field('â° Tage verbleibend', `${daysRemaining} ${daysRemaining === 1 ? 'Tag' : 'Tage'}`),\n                SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n            ]\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Section mit Aktion erforderlich (mit Builder)\n        SlackBlockBuilder.section({\n            text: `*ğŸš¨ Aktion erforderlich:*\\nDie Lizenz ist abgelaufen und muss erneuert werden.`\n        }),\n        // Section mit Kontakt-Info (mit Builder)\n        SlackBlockBuilder.section({\n            text: `*ğŸ“§ Kontakt:*\\nâ€¢ Lizenz erneuern bei <https://www.matt-interfaces.ch|Matt Interfaces>\\nâ€¢ Repository: <https://github.com/chooomedia/hero-blocks|GitHub>`\n        }),\n        // Divider\n        SlackBlockBuilder.divider(),\n        // Actions mit Button-Gruppe (Primary + Danger - mit Builder)\n        SlackBlockBuilder.actions([\n            SlackBlockBuilder.button({\n                text: 'ğŸ“§ Kontakt aufnehmen',\n                style: 'primary',\n                url: 'https://www.matt-interfaces.ch',\n                actionId: 'contact_support'\n            }),\n            SlackBlockBuilder.button({\n                text: 'ğŸ”— Repository',\n                style: 'primary',\n                url: 'https://github.com/chooomedia/hero-blocks',\n                actionId: 'open_repository'\n            }),\n            SlackBlockBuilder.button({\n                text: 'ğŸ—‘ï¸ LÃ¶schen',\n                style: 'danger',\n                actionId: 'delete_message',\n                value: messageId\n            })\n        ]),\n        // Context Block fÃ¼r Footer (Metadaten - mit Builder)\n        SlackBlockBuilder.context([\n            SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion} | âŒ Lizenz abgelaufen`)\n        ])\n    ];\n}\n\nreturn {\n    json: {\n        ...$input.item.json,\n        slackMessage: text, // Plain Text Fallback\n        slackBlocks: blocks, // Blocks API Format\n        messageId: messageId // FÃ¼r Delete-Button\n    }\n};"
            },
            "id": "764b1671-c0d6-47eb-b4e1-bb9338679449",
            "name": "Code (Format Slack Message - License)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -1952,
                272
            ]
        },
        {
            "parameters": {
                "jsCode": "// ============================================================================\n// ZENTRALER SLACK BLOCK BUILDER - Erstellt Blocks basierend auf verfÃ¼gbaren Daten\n// ============================================================================\n// Best Practices: Slack Blocks API - Alle Block-Typen unterstÃ¼tzt\n// Referenz: https://api.slack.com/reference/block-kit/blocks\n// Block Kit Builder: https://app.slack.com/block-kit-builder\n// n8n Slack Node: https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.slack/\n// ============================================================================\n\n/**\n * UNIVERSAL SLACK BLOCK BUILDER\n * Erstellt alle Slack Block-Typen mit vollstÃ¤ndiger Konfiguration\n * UnterstÃ¼tzt: header, divider, section, actions, context, image, input, file, video, rich_text\n */\nconst SlackBlockBuilder = {\n  // ========================================================================\n  // BASIS BLOCKS\n  // ========================================================================\n  header: (text, emoji = true, blockId = null) => {\n    const block = {\n      type: 'header',\n      text: { type: 'plain_text', text: text, emoji: emoji }\n    };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  divider: (blockId = null) => {\n    const block = { type: 'divider' };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  section: (config = {}) => {\n    const block = { type: 'section' };\n    if (config.blockId) block.block_id = config.blockId;\n    if (config.text) {\n      block.text = {\n        type: config.textType || 'mrkdwn',\n        text: config.text,\n        verbatim: config.verbatim !== false\n      };\n    }\n    if (config.fields && Array.isArray(config.fields)) {\n      block.fields = config.fields.map(field => ({\n        type: field.type || 'mrkdwn',\n        text: field.text || field,\n        verbatim: field.verbatim !== false\n      }));\n    }\n    if (config.accessory) block.accessory = config.accessory;\n    return block;\n  },\n  actions: (elements = [], blockId = null) => {\n    const block = { type: 'actions', elements: elements };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  context: (elements = [], blockId = null) => {\n    const block = {\n      type: 'context',\n      elements: Array.isArray(elements) ? elements.map(el => ({\n        type: el.type || 'mrkdwn',\n        text: el.text || el,\n        verbatim: el.verbatim !== false\n      })) : [{ type: 'mrkdwn', text: elements, verbatim: false }]\n    };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  // ========================================================================\n  // ERWEITERTE BLOCKS\n  // ========================================================================\n  image: (imageUrl, altText, title = null, blockId = null) => {\n    const block = {\n      type: 'image',\n      image_url: imageUrl,\n      alt_text: altText\n    };\n    if (title) block.title = { type: 'plain_text', text: title, emoji: false };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  input: (label, element, hint = null, optional = false, blockId = null) => {\n    const block = {\n      type: 'input',\n      label: { type: 'plain_text', text: label, emoji: false },\n      element: element\n    };\n    if (hint) block.hint = { type: 'plain_text', text: hint, emoji: false };\n    if (optional) block.optional = true;\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  file: (externalId, source = 'remote', blockId = null) => {\n    const block = {\n      type: 'file',\n      external_id: externalId,\n      source: source\n    };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  video: (videoUrl, thumbnailUrl, altText, title, authorName = null, description = null, blockId = null) => {\n    const block = {\n      type: 'video',\n      video_url: videoUrl,\n      thumbnail_url: thumbnailUrl,\n      alt_text: altText,\n      title: { type: 'plain_text', text: title, emoji: false }\n    };\n    if (authorName) block.author_name = authorName;\n    if (description) block.description = { type: 'plain_text', text: description, emoji: false };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  richText: (elements = [], blockId = null) => {\n    const block = {\n      type: 'rich_text',\n      elements: elements\n    };\n    if (blockId) block.block_id = blockId;\n    return block;\n  },\n  \n  // ========================================================================\n  // ACTION ELEMENTS (fÃ¼r actions Block)\n  // ========================================================================\n  button: (config = {}) => {\n    const button = {\n      type: 'button',\n      text: { type: 'plain_text', text: config.text || 'Button', emoji: config.emoji !== false },\n      action_id: config.actionId || config.action_id || 'button_click'\n    };\n    if (config.style) button.style = config.style; // primary, danger\n    if (config.url) button.url = config.url;\n    if (config.value) button.value = config.value;\n    if (config.confirm) button.confirm = config.confirm;\n    if (config.accessibleLabel) button.accessible_label = config.accessibleLabel;\n    return button;\n  },\n  \n  selectMenu: (config = {}) => {\n    const menu = {\n      type: 'static_select',\n      placeholder: { type: 'plain_text', text: config.placeholder || 'Select...', emoji: false },\n      action_id: config.actionId || config.action_id || 'select_menu'\n    };\n    if (config.options && Array.isArray(config.options)) {\n      menu.options = config.options.map(opt => ({\n        text: { type: 'plain_text', text: opt.text || opt.label, emoji: opt.emoji !== false },\n        value: opt.value || opt.text || opt.label\n      }));\n    }\n    if (config.initialOption) {\n      menu.initial_option = {\n        text: { type: 'plain_text', text: config.initialOption.text || config.initialOption.label, emoji: false },\n        value: config.initialOption.value || config.initialOption.text || config.initialOption.label\n      };\n    }\n    if (config.confirm) menu.confirm = config.confirm;\n    return menu;\n  },\n  \n  datePicker: (actionId, placeholder = 'Select a date', initialDate = null, confirm = null) => {\n    const picker = {\n      type: 'datepicker',\n      placeholder: { type: 'plain_text', text: placeholder, emoji: false },\n      action_id: actionId\n    };\n    if (initialDate) picker.initial_date = initialDate;\n    if (confirm) picker.confirm = confirm;\n    return picker;\n  },\n  \n  overflowMenu: (actionId, options = []) => {\n    return {\n      type: 'overflow',\n      action_id: actionId,\n      options: options.map(opt => ({\n        text: { type: 'plain_text', text: opt.text || opt.label, emoji: opt.emoji !== false },\n        value: opt.value || opt.text || opt.label\n      }))\n    };\n  },\n  \n  // ========================================================================\n  // HELPER FUNCTIONS\n  // ========================================================================\n  field: (label, value, type = 'mrkdwn', emoji = true) => ({\n    type: type,\n    text: `${emoji ? '' : ''}*${label}:*\\n${value}`,\n    verbatim: false\n  }),\n  \n  contextElement: (text, type = 'mrkdwn') => ({ \n    type: type, \n    text: text,\n    verbatim: false\n  }),\n  \n  // ========================================================================\n  // MARKDOWN HELPER FUNCTIONS\n  // ========================================================================\n  markdown: {\n    link: (url, text = null) => text ? `<${url}|${text}>` : `<${url}>`,\n    code: (text) => `\\`${text}\\``,\n    codeBlock: (code, language = '') => `\\`\\`\\`${language}\\n${code}\\n\\`\\`\\``,\n    bold: (text) => `*${text}*`,\n    italic: (text) => `_${text}_`,\n    strikethrough: (text) => `~${text}~`,\n    list: (items, ordered = false) => {\n      return items.map((item, idx) => ordered ? `${idx + 1}. ${item}` : `â€¢ ${item}`).join('\\n');\n    },\n    mention: (userId) => `<@${userId}>`,\n    channel: (channelId) => `<#${channelId}>`,\n    here: () => '<!here>',\n    everyone: () => '<!everyone>'\n  },\n  \n  // ========================================================================\n  // FORMATTING HELPER FUNCTIONS\n  // ========================================================================\n  format: {\n    version: (version) => `\\`${version}\\``,\n    date: (timestamp, locale = 'de-DE') => {\n      if (!timestamp) return 'Unbekannt';\n      try {\n        const date = new Date(timestamp);\n        return date.toLocaleDateString(locale, { \n          year: 'numeric', \n          month: 'short', \n          day: 'numeric', \n          hour: '2-digit', \n          minute: '2-digit' \n        });\n      } catch (e) { return 'Unbekannt'; }\n    },\n    relativeTime: (timestamp) => {\n      if (!timestamp) return 'Unbekannt';\n      try {\n        const now = Date.now();\n        const then = new Date(timestamp).getTime();\n        const diff = now - then;\n        const seconds = Math.floor(diff / 1000);\n        const minutes = Math.floor(seconds / 60);\n        const hours = Math.floor(minutes / 60);\n        const days = Math.floor(hours / 24);\n        \n        if (days > 0) return `vor ${days} ${days === 1 ? 'Tag' : 'Tagen'}`;\n        if (hours > 0) return `vor ${hours} ${hours === 1 ? 'Stunde' : 'Stunden'}`;\n        if (minutes > 0) return `vor ${minutes} ${minutes === 1 ? 'Minute' : 'Minuten'}`;\n        return 'gerade eben';\n      } catch (e) { return 'Unbekannt'; }\n    },\n    bytes: (bytes) => {\n      if (bytes === 0) return '0 B';\n      const k = 1024;\n      const sizes = ['B', 'KB', 'MB', 'GB'];\n      const i = Math.floor(Math.log(bytes) / Math.log(k));\n      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n    },\n    progressBar: (current, total, length = 10) => {\n      const percentage = Math.min(100, Math.max(0, (current / total) * 100));\n      const filled = Math.round((percentage / 100) * length);\n      const empty = length - filled;\n      return 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty) + ` ${Math.round(percentage)}%`;\n    },\n    badge: (text, color = 'default') => {\n      const colors = {\n        success: 'âœ…',\n        warning: 'âš ï¸',\n        danger: 'âŒ',\n        info: 'â„¹ï¸',\n        default: 'ğŸ”¹'\n      };\n      return `${colors[color] || colors.default} ${text}`;\n    }\n  }\n};\n\n// ============================================================================\n// ERSTELLE SLACK BLOCKS BASIEREND AUF VERFÃœGBAREN DATEN\n// ============================================================================\n\n// Versuche Blocks aus verschiedenen Quellen zu erhalten\nlet blocks = $input.item.json.slackBlocks || null;\nlet text = $input.item.json.slackMessage || null;\n\n// Wenn Blocks bereits vorhanden sind (von Code Nodes), verwende diese\nif (blocks && Array.isArray(blocks) && blocks.length > 0) {\n  return {\n    json: {\n      ...$input.item.json,\n      slackBlocks: blocks,\n      slackMessage: text || 'Hero Blocks Notification'\n    }\n  };\n}\n\n// Fallback: Erstelle Blocks basierend auf verfÃ¼gbaren Daten\nconst checkType = $input.item.json.checkType || 'update';\nconst currentVersion = $input.item.json.currentVersion || $input.item.json.query?.currentVersion || '1.0.0';\nconst valid = $input.item.json.valid === true;\nconst available = $input.item.json.available || false;\nconst latestVersion = $input.item.json.latestVersion || currentVersion;\nconst hasError = $input.item.json.hasError === true;\nconst githubError = $input.item.json.githubError || null;\nconst downloadUrl = $input.item.json.downloadUrl || null;\nconst changelog = $input.item.json.changelog || null;\nconst githubReleaseUrl = $input.item.json.githubReleaseUrl || null;\nconst githubPublishedAt = $input.item.json.githubPublishedAt || null;\nconst expiresAt = $input.item.json.expiresAt || null;\nconst daysRemaining = $input.item.json.daysRemaining || 0;\nconst plugin = $input.item.json.plugin || 'hero-blocks';\nconst shopwareVersion = $input.item.json.shopwareVersion || $input.item.json.query?.shopwareVersion || '6.7.0';\n\n// Erweiterte GitHub Release Daten\nconst githubRelease = $input.item.json.author || $input.item.json;\nconst githubAuthor = githubRelease?.login || githubRelease?.author?.login || 'GitHub Actions';\nconst githubAuthorAvatar = githubRelease?.avatar_url || githubRelease?.author?.avatar_url || null;\nconst githubTag = $input.item.json.githubTag || $input.item.json.tag_name || `v${latestVersion}`;\nconst githubReleaseId = $input.item.json.githubReleaseId || $input.item.json.id || null;\nconst githubAssets = $input.item.json.assets || $input.item.json.githubAssets || [];\nconst downloadCount = githubAssets.length > 0 ? githubAssets[0]?.download_count || 0 : 0;\nconst assetSize = githubAssets.length > 0 ? githubAssets[0]?.size || 0 : 0;\nconst assetName = githubAssets.length > 0 ? githubAssets[0]?.name || null : null;\nconst prerelease = $input.item.json.prerelease === true || $input.item.json.draft === true;\nconst body = $input.item.json.body || changelog || '';\n\nconst messageId = `hero-blocks-${checkType}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n// Formatierte Changelog (decode URL encoding und formatieren)\nconst formatChangelog = (rawChangelog) => {\n  if (!rawChangelog) return null;\n  try {\n    // Decode URL encoding (%0A -> \\n, etc.)\n    let decoded = decodeURIComponent(rawChangelog.replace(/\\+/g, ' '));\n    // Entferne Markdown-Header falls vorhanden\n    decoded = decoded.replace(/^##\\s+[^\\n]+\\n\\n/g, '');\n    // KÃ¼rze auf max 800 Zeichen fÃ¼r Slack\n    if (decoded.length > 800) {\n      decoded = decoded.substring(0, 797) + '...';\n    }\n    return decoded;\n  } catch (e) {\n    return rawChangelog.substring(0, 500);\n  }\n};\n\nconst formattedChangelog = formatChangelog(changelog || body);\n\n// Erstelle Blocks basierend auf Check-Type\nif (checkType === 'license') {\n  const statusInfo = valid ? \n    (daysRemaining > 90 ? { emoji: 'âœ…', text: 'GÃ¼ltig' } : daysRemaining > 30 ? { emoji: 'âš ï¸', text: 'LÃ¤uft bald ab' } : { emoji: 'ğŸš¨', text: 'LÃ¤uft sehr bald ab' }) :\n    { emoji: 'âŒ', text: 'Abgelaufen' };\n  const expiryDate = expiresAt ? SlackBlockBuilder.format.date(expiresAt) : 'Unbekannt';\n  \n  text = valid ? `âœ… Hero Blocks License Check - ${statusInfo.text}` : `âš ï¸ Hero Blocks License Check - Abgelaufen`;\n  \n  if (valid) {\n    blocks = [\n      SlackBlockBuilder.header(`${statusInfo.emoji} Hero Blocks License Check - ${statusInfo.text}`),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({\n        fields: [\n          SlackBlockBuilder.field('ğŸ”§ Plugin', plugin),\n          SlackBlockBuilder.field('ğŸ“¦ Version', currentVersion),\n          SlackBlockBuilder.field(`${statusInfo.emoji} Status`, statusInfo.text),\n          SlackBlockBuilder.field('ğŸ“… Ablaufdatum', expiryDate),\n          SlackBlockBuilder.field('â° Tage verbleibend', `${daysRemaining} ${daysRemaining === 1 ? 'Tag' : 'Tage'}`),\n          SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n        ]\n      }),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.actions([\n        SlackBlockBuilder.button({ text: 'ğŸ”— Repository', style: 'primary', url: 'https://github.com/chooomedia/hero-blocks', actionId: 'open_repository' }),\n        SlackBlockBuilder.button({ text: 'ğŸ—‘ï¸ LÃ¶schen', style: 'danger', actionId: 'delete_message', value: messageId })\n      ]),\n      SlackBlockBuilder.context([SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion} | ${daysRemaining} Tage verbleibend`)])\n    ];\n  } else {\n    blocks = [\n      SlackBlockBuilder.header('ğŸš¨ Hero Blocks License Check - Abgelaufen'),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({\n        fields: [\n          SlackBlockBuilder.field('ğŸ”§ Plugin', plugin),\n          SlackBlockBuilder.field('ğŸ“¦ Version', currentVersion),\n          SlackBlockBuilder.field('âŒ Status', 'Abgelaufen'),\n          SlackBlockBuilder.field('ğŸ“… Ablaufdatum', expiryDate),\n          SlackBlockBuilder.field('â° Tage verbleibend', `${daysRemaining} ${daysRemaining === 1 ? 'Tag' : 'Tage'}`),\n          SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n        ]\n      }),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({ text: `*ğŸš¨ Aktion erforderlich:*\\nDie Lizenz ist abgelaufen und muss erneuert werden.` }),\n      SlackBlockBuilder.section({ text: `*ğŸ“§ Kontakt:*\\nâ€¢ Lizenz erneuern bei <https://www.matt-interfaces.ch|Matt Interfaces>\\nâ€¢ Repository: <https://github.com/chooomedia/hero-blocks|GitHub>` }),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.actions([\n        SlackBlockBuilder.button({ text: 'ğŸ“§ Kontakt aufnehmen', style: 'primary', url: 'https://www.matt-interfaces.ch', actionId: 'contact_support' }),\n        SlackBlockBuilder.button({ text: 'ğŸ”— Repository', style: 'primary', url: 'https://github.com/chooomedia/hero-blocks', actionId: 'open_repository' }),\n        SlackBlockBuilder.button({ text: 'ğŸ—‘ï¸ LÃ¶schen', style: 'danger', actionId: 'delete_message', value: messageId })\n      ]),\n      SlackBlockBuilder.context([SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion} | âŒ Lizenz abgelaufen`)])\n    ];\n  }\n} else if (checkType === 'update') {\n  \n  if (hasError) {\n    text = `âš ï¸ Hero Blocks Update Check - Fehler`;\n    blocks = [\n      SlackBlockBuilder.header('âš ï¸ Hero Blocks Update Check - Fehler'),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({\n        fields: [\n          SlackBlockBuilder.field('Fehler', githubError || 'Unbekannter Fehler'),\n          SlackBlockBuilder.field('Aktuelle Version', currentVersion),\n          SlackBlockBuilder.field('Status', 'âŒ Kein Release gefunden'),\n          SlackBlockBuilder.field('Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n        ]\n      }),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({ text: `*ğŸ” MÃ¶gliche Ursachen:*\\nâ€¢ Repository existiert nicht\\nâ€¢ Keine Releases vorhanden\\nâ€¢ GitHub API Rate Limit erreicht` }),\n      SlackBlockBuilder.section({ text: `*ğŸ’¡ LÃ¶sung:*\\nâ€¢ PrÃ¼fe <https://github.com/chooomedia/hero-blocks/releases|GitHub Releases>\\nâ€¢ Erstelle erstes Release falls nÃ¶tig\\nâ€¢ PrÃ¼fe n8n Workflow Logs` }),\n      SlackBlockBuilder.actions([\n        SlackBlockBuilder.button({ text: 'ğŸ”— GitHub Ã¶ffnen', style: 'primary', url: 'https://github.com/chooomedia/hero-blocks/releases', actionId: 'open_github' }),\n        SlackBlockBuilder.button({ text: 'ğŸ—‘ï¸ LÃ¶schen', style: 'danger', actionId: 'delete_message', value: messageId })\n      ]),\n      SlackBlockBuilder.context([SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ Version ${currentVersion}`)])\n    ];\n  } else if (available) {\n    // Erweiterte Formatierung mit neuen Helper-Funktionen\n    const publishedDateFormatted = SlackBlockBuilder.format.date(githubPublishedAt);\n    const publishedRelative = SlackBlockBuilder.format.relativeTime(githubPublishedAt);\n    const assetSizeFormatted = assetSize > 0 ? SlackBlockBuilder.format.bytes(assetSize) : null;\n    const versionBadge = SlackBlockBuilder.format.badge(latestVersion, prerelease ? 'warning' : 'success');\n    const repoLink = SlackBlockBuilder.markdown.link('https://github.com/chooomedia/hero-blocks', 'chooomedia/hero-blocks');\n    const releaseLink = SlackBlockBuilder.markdown.link(githubReleaseUrl || `https://github.com/chooomedia/hero-blocks/releases/tag/${githubTag}`, githubTag);\n    \n    text = `âœ… Hero Blocks Update verfÃ¼gbar: ${latestVersion}`;\n    \n    const actionElements = [];\n    if (downloadUrl) {\n      actionElements.push(SlackBlockBuilder.button({ \n        text: 'â¬‡ï¸ Download', \n        style: 'primary', \n        url: downloadUrl, \n        actionId: 'download_update',\n        accessibleLabel: `Download ${assetName || 'hero-blocks-' + latestVersion + '.zip'}`\n      }));\n    }\n    if (githubReleaseUrl) {\n      actionElements.push(SlackBlockBuilder.button({ \n        text: 'ğŸ”— Release ansehen', \n        style: 'primary', \n        url: githubReleaseUrl, \n        actionId: 'view_release'\n      }));\n    }\n    actionElements.push(SlackBlockBuilder.button({ \n      text: 'ğŸ—‘ï¸ LÃ¶schen', \n      style: 'danger', \n      actionId: 'delete_message', \n      value: messageId\n    }));\n    \n    blocks = [];\n    \n    // Header mit Badge\n    blocks.push(SlackBlockBuilder.header(\n      `${prerelease ? 'ğŸš§' : 'ğŸš€'} Hero Blocks Update verfÃ¼gbar: ${versionBadge}`,\n      true,\n      'update-header'\n    ));\n    \n    blocks.push(SlackBlockBuilder.divider('update-divider-1'));\n    \n    // Haupt-Section mit erweiterten Feldern\n    const mainFields = [\n      SlackBlockBuilder.field('ğŸ“¦ Aktuelle Version', SlackBlockBuilder.format.version(currentVersion)),\n      SlackBlockBuilder.field('âœ¨ Neue Version', SlackBlockBuilder.format.version(latestVersion)),\n      SlackBlockBuilder.field('ğŸ“… VerÃ¶ffentlicht', `${publishedDateFormatted}\\n_${publishedRelative}_`),\n      SlackBlockBuilder.field('ğŸ”– Release', releaseLink)\n    ];\n    \n    // ZusÃ¤tzliche Felder wenn verfÃ¼gbar\n    if (assetSizeFormatted) {\n      mainFields.push(SlackBlockBuilder.field('ğŸ“¦ DateigrÃ¶ÃŸe', assetSizeFormatted));\n    }\n    if (downloadCount > 0) {\n      mainFields.push(SlackBlockBuilder.field('â¬‡ï¸ Downloads', `${downloadCount.toLocaleString('de-DE')} ${downloadCount === 1 ? 'Download' : 'Downloads'}`));\n    }\n    if (shopwareVersion) {\n      mainFields.push(SlackBlockBuilder.field('ğŸ› ï¸ Shopware', `v${shopwareVersion}`));\n    }\n    \n    blocks.push(SlackBlockBuilder.section({\n      fields: mainFields,\n      blockId: 'update-main-info'\n    }));\n    \n    // GitHub Author Avatar (falls verfÃ¼gbar)\n    if (githubAuthorAvatar) {\n      blocks.push(SlackBlockBuilder.image(\n        githubAuthorAvatar,\n        `GitHub Avatar von ${githubAuthor}`,\n        `VerÃ¶ffentlicht von ${githubAuthor}`,\n        'author-avatar'\n      ));\n      blocks.push(SlackBlockBuilder.divider('update-divider-author'));\n    }\n    \n    // Download-Section mit erweiterten Informationen\n    if (downloadUrl) {\n      const downloadText = assetName ? \n        `${SlackBlockBuilder.markdown.bold('ğŸ“¥ Download:')}\\n${SlackBlockBuilder.markdown.link(downloadUrl, assetName)}` :\n        `${SlackBlockBuilder.markdown.bold('ğŸ“¥ Download:')}\\n${SlackBlockBuilder.markdown.link(downloadUrl, `hero-blocks-${latestVersion}.zip`)}`;\n      \n      blocks.push(SlackBlockBuilder.section({\n        text: downloadText,\n        accessory: SlackBlockBuilder.button({ \n          text: 'â¬‡ï¸ Download', \n          style: 'primary', \n          url: downloadUrl, \n          actionId: 'download_update'\n        }),\n        blockId: 'update-download'\n      }));\n      blocks.push(SlackBlockBuilder.divider('update-divider-download'));\n    }\n    \n    // Changelog-Section mit formatierter Ausgabe\n    if (formattedChangelog) {\n      const changelogLines = formattedChangelog.split('\\n').slice(0, 15); // Max 15 Zeilen\n      const changelogText = `${SlackBlockBuilder.markdown.bold('ğŸ“ Changelog:')}\\n${SlackBlockBuilder.markdown.codeBlock(changelogLines.join('\\n'), '')}`;\n      \n      blocks.push(SlackBlockBuilder.section({\n        text: changelogText,\n        blockId: 'update-changelog'\n      }));\n      blocks.push(SlackBlockBuilder.divider('update-divider-changelog'));\n    }\n    \n    // Actions mit erweiterten Buttons\n    blocks.push(SlackBlockBuilder.actions(actionElements, 'update-actions'));\n    \n    // Context mit erweiterten Informationen\n    const contextElements = [\n      SlackBlockBuilder.contextElement(\n        `â° ${SlackBlockBuilder.format.date(new Date().toISOString())} | ` +\n        `ğŸ”§ ${SlackBlockBuilder.markdown.bold('Hero Blocks Plugin')} | ` +\n        `ğŸ“¦ ${SlackBlockBuilder.format.version(currentVersion)} â†’ ${SlackBlockBuilder.format.version(latestVersion)} | ` +\n        `ğŸ”— ${repoLink}`\n      )\n    ];\n    \n    if (githubAuthor && githubAuthor !== 'GitHub Actions') {\n      contextElements.push(SlackBlockBuilder.contextElement(`ğŸ‘¤ VerÃ¶ffentlicht von ${githubAuthor}`));\n    }\n    \n    blocks.push(SlackBlockBuilder.context(contextElements, 'update-context'));\n  } else {\n    text = `â„¹ï¸ Hero Blocks - Kein Update verfÃ¼gbar`;\n    blocks = [\n      SlackBlockBuilder.header('â„¹ï¸ Hero Blocks - Kein Update verfÃ¼gbar'),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.section({\n        fields: [\n          SlackBlockBuilder.field('ğŸ“¦ Aktuelle Version', `\\`${currentVersion}\\``),\n          SlackBlockBuilder.field('âœ¨ Neueste Version', `\\`${latestVersion}\\``),\n          SlackBlockBuilder.field('âœ… Status', 'Plugin ist aktuell'),\n          SlackBlockBuilder.field('ğŸ”– Repository', '<https://github.com/chooomedia/hero-blocks|chooomedia/hero-blocks>')\n        ]\n      }),\n      SlackBlockBuilder.divider(),\n      SlackBlockBuilder.actions([SlackBlockBuilder.button({ text: 'ğŸ—‘ï¸ LÃ¶schen', style: 'danger', actionId: 'delete_message', value: messageId })]),\n      SlackBlockBuilder.context([SlackBlockBuilder.contextElement(`â° ${new Date().toLocaleString('de-DE')} | ğŸ”§ Hero Blocks Plugin | ğŸ“¦ ${currentVersion}`)])\n    ];\n  }\n}\n\n// Fallback: Leere Blocks wenn nichts gefunden\nif (!blocks || !Array.isArray(blocks) || blocks.length === 0) {\n  text = 'Hero Blocks Notification';\n  blocks = [\n    SlackBlockBuilder.header('â„¹ï¸ Hero Blocks Notification'),\n    SlackBlockBuilder.section({ text: `*Status:*\\nKeine weiteren Informationen verfÃ¼gbar.` }),\n    SlackBlockBuilder.actions([SlackBlockBuilder.button({ text: 'ğŸ—‘ï¸ LÃ¶schen', style: 'danger', actionId: 'delete_message', value: messageId })])\n  ];\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    slackBlocks: blocks,\n    slackMessage: text,\n    messageId: messageId\n  }\n};"
            },
            "id": "356a1465-27e4-4b3a-97b6-0f53cfb21717",
            "name": "Code (Build Slack Blocks)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -1104,
                -112
            ]
        },
        {
            "parameters": {
                "authentication": "oAuth2",
                "select": "channel",
                "channelId": {
                    "__rl": true,
                    "value": "C04347838EP",
                    "mode": "list",
                    "cachedResultName": "horex"
                },
                "messageType": "block",
                "blocksUi": "={{ $json.slackBlocks }}",
                "text": "={{ $json.slackMessage }}",
                "otherOptions": {
                    "includeLinkToWorkflow": true,
                    "mrkdwn": true
                }
            },
            "type": "n8n-nodes-base.slack",
            "typeVersion": 2.3,
            "position": [
                -912,
                -112
            ],
            "id": "f9c60d5d-bfc9-47cb-b166-842b84310d7c",
            "name": "Send Slack Message (Update)",
            "webhookId": "40f85c4f-6f84-4aeb-89aa-181e6937b9a8",
            "credentials": {
                "slackOAuth2Api": {
                    "id": "BSSygESdYnPg0W2W",
                    "name": "Slack account"
                }
            }
        },
        {
            "parameters": {
                "jsCode": "// WICHTIG: Verarbeite Slack Interactive Components (Button Clicks)\n// Best Practices: Slack Interactive Components API - Button Click Handler\n// Referenz: https://api.slack.com/interactivity/handling\n\n// Slack sendet Button Clicks als URL-encoded payload\n// n8n gibt den Payload als String zurÃ¼ck (muss geparst werden)\n\nlet payload = null;\nconst body = $input.item.json.body || $input.item.json || {};\n\n// Versuche Payload zu parsen (URL-encoded oder JSON)\nif (typeof body === 'string') {\n  try {\n    // URL-encoded payload (Standard fÃ¼r Slack Interactive Components)\n    const urlParams = new URLSearchParams(body);\n    const payloadStr = urlParams.get('payload');\n    if (payloadStr) {\n      payload = JSON.parse(payloadStr);\n    } else {\n      // Fallback: Direktes JSON\n      payload = JSON.parse(body);\n    }\n  } catch (e) {\n    // Payload bereits als Objekt\n    payload = body.payload ? JSON.parse(body.payload) : body;\n  }\n} else if (body.payload) {\n  // Payload als String in body.payload\n  payload = typeof body.payload === 'string' ? JSON.parse(body.payload) : body.payload;\n} else {\n  // Payload direkt als Objekt\n  payload = body;\n}\n\n// Extrahiere Button Action\nconst action = payload?.actions?.[0];\nconst actionId = action?.action_id;\nconst messageTs = payload?.message?.ts; // Message Timestamp (fÃ¼r chat.deleteMessage)\nconst channelId = payload?.channel?.id;\nconst userId = payload?.user?.id;\n\n// PrÃ¼fe Button-Actions\nif (actionId === 'delete_message' && messageTs && channelId) {\n  // Delete-Button geklickt\n  return {\n    json: {\n      action: 'delete',\n      actionId: actionId,\n      messageTs: messageTs,\n      channelId: channelId,\n      userId: userId,\n      value: action?.value || null,\n      // Response fÃ¼r Slack (sofortige BestÃ¤tigung)\n      slackResponse: {\n        response_type: 'ephemeral',\n        text: 'âœ… Nachricht wird gelÃ¶scht...'\n      }\n    }\n  };\n} else if (actionId === 'vote_useful' && messageTs && channelId) {\n  // Vote-Button geklickt - Danke-Message als Ephemeral\n  return {\n    json: {\n      action: 'vote',\n      actionId: actionId,\n      messageTs: messageTs,\n      channelId: channelId,\n      userId: userId,\n      value: action?.value || null,\n      // Response fÃ¼r Slack (sofortige BestÃ¤tigung)\n      slackResponse: {\n        response_type: 'ephemeral',\n        text: 'ğŸ‘ Danke fÃ¼r dein Feedback!'\n      }\n    }\n  };\n}\n\n// Unbekannte Action\nreturn {\n  json: {\n    action: 'unknown',\n    actionId: actionId || null,\n    payload: payload\n  }\n};"
            },
            "id": "7766dd06-793d-4ee1-a325-39b20d33c607",
            "name": "Code (Process Interactive Action)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -720,
                176
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ $json.slackResponse || { response_type: 'ephemeral', text: 'Aktion verarbeitet' } }}",
                "options": {}
            },
            "id": "3773c813-1256-4610-9fa7-03144e16047b",
            "name": "Respond (Slack Acknowledgment)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                -512,
                -112
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "id": "d4e5f6a7-b8c9-0123-def4-456789012345",
                            "leftValue": "={{ $json.action }}",
                            "rightValue": "delete",
                            "operator": {
                                "type": "string",
                                "operation": "equals",
                                "name": "filter.operator.equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "494cfba4-2ad5-42de-a672-949ef035f7e2",
            "name": "IF Action = Delete?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                -512,
                176
            ]
        },
        {
            "parameters": {
                "authentication": "oAuth2",
                "operation": "delete",
                "select": "channel",
                "channelId": {
                    "__rl": true,
                    "value": "C04347838EP",
                    "mode": "list",
                    "cachedResultName": "horex"
                },
                "timestamp": "={{ $json.messageTs }}"
            },
            "type": "n8n-nodes-base.slack",
            "typeVersion": 2.3,
            "position": [
                -272,
                176
            ],
            "id": "5c77df72-ac3b-4d03-97aa-2bd1ad46e6a7",
            "name": "Delete Slack Message",
            "webhookId": "bed2455a-3e80-4b81-b90a-b9c0aa952221",
            "notesInFlow": true,
            "credentials": {
                "slackOAuth2Api": {
                    "id": "BSSygESdYnPg0W2W",
                    "name": "Slack account"
                }
            },
            "continueOnFail": true
        },
        {
            "parameters": {
                "jsCode": "// WICHTIG: Error-Handling fÃ¼r Delete Slack Message\n// Best Practices: Robuste Fehlerbehandlung gemÃ¤ÃŸ n8n Dokumentation\n// PrÃ¼ft ob Delete erfolgreich war oder Fehler aufgetreten ist\n\nconst deleteResult = $input.item.json;\nconst hasError = deleteResult.error || deleteResult.statusCode === 'error' || !deleteResult.ok;\n\nif (hasError) {\n  // Delete fehlgeschlagen - logge Fehler\n  const errorMsg = deleteResult.error?.message || deleteResult.message || 'Unbekannter Fehler';\n  const errorCode = deleteResult.error?.code || deleteResult.statusCode || 'unknown';\n  \n  return {\n    json: {\n      ...deleteResult,\n      deleteSuccess: false,\n      error: errorMsg,\n      errorCode: errorCode,\n      // MÃ¶gliche Ursachen:\n      // - Message bereits gelÃ¶scht\n      // - Keine Berechtigung\n      // - UngÃ¼ltiger Timestamp\n      // - Message nicht gefunden\n      timestamp: new Date().toISOString()\n    }\n  };\n}\n\n// Delete erfolgreich\nreturn {\n  json: {\n    ...deleteResult,\n    deleteSuccess: true,\n    timestamp: new Date().toISOString()\n  }\n};"
            },
            "id": "af60ade3-d0e9-46c8-b1fe-272fe5f301e5",
            "name": "Code (Delete Error Handler)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                64,
                176
            ]
        },
        {
            "parameters": {
                "path": "license/hero-blocks",
                "responseMode": "responseNode",
                "options": {
                    "responseHeaders": {
                        "entries": [
                            {
                                "name": "Content-Type",
                                "value": "application/json"
                            }
                        ]
                    }
                }
            },
            "id": "53850128-67c7-4564-99cd-ce872a046913",
            "name": "Webhook",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                -3168,
                -112
            ],
            "webhookId": "hero-blocks-unified"
        },
        {
            "parameters": {
                "jsCode": "// WICHTIG: Route-Bestimmung basierend auf Query-Parameter (n8n Best Practice!)\n// Best Practices: Robust, sauber, eindeutige Logik gemÃ¤ÃŸ n8n Dokumentation\n// n8n Webhook Path: hero-blocks (relativ zum Webhook-Base /webhook/)\n// VollstÃ¤ndiger Path: /webhook/hero-blocks?checkType=license oder /webhook/hero-blocks?checkType=update\n// GemÃ¤ÃŸ n8n Docs: Query-Parameter werden in query zurÃ¼ckgegeben\n\nlet checkType = null;\n\n// Step 1: Versuche Query-Parameter checkType (PRIMÃ„R - n8n Best Practice!)\n// n8n gibt Query-Parameter in $input.item.json.query zurÃ¼ck\nconst queryParams = $input.item.json.query || {};\nif (queryParams.checkType) {\n  checkType = String(queryParams.checkType).toLowerCase().trim();\n}\n\n// Step 2: Extrahiere aus webhookUrl (Fallback - falls Query-Parameter nicht verfÃ¼gbar)\n// URL-Format: https://n8n.chooomedia.com/webhook/license/hero-blocks\n// oder: https://n8n.chooomedia.com/webhook/update/hero-blocks\n// ODER: https://n8n.chooomedia.com/webhook/hero-blocks?checkType=license\nif (!checkType && $input.item.json.webhookUrl) {\n  const url = String($input.item.json.webhookUrl);\n  // Matche: /webhook/license/hero-blocks oder /webhook/update/hero-blocks (altes Format)\n  const urlMatch = url.match(/\\/webhook\\/(license|update)\\/hero-blocks/i);\n  if (urlMatch && urlMatch[1]) {\n    checkType = urlMatch[1].toLowerCase().trim(); // license oder update\n  } else {\n    // Versuche Query-Parameter aus URL\n    const urlObj = new URL(url);\n    const checkTypeParam = urlObj.searchParams.get('checkType');\n    if (checkTypeParam) {\n      checkType = checkTypeParam.toLowerCase().trim();\n    }\n  }\n}\n\n// Step 3: Fallback: Versuche aus Request-URL zu extrahieren\nif (!checkType && $input.item.json.url) {\n  const url = String($input.item.json.url);\n  // Matche: /webhook/license/hero-blocks oder /webhook/update/hero-blocks\n  const urlMatch = url.match(/\\/(license|update)\\//i);\n  if (urlMatch && urlMatch[1]) {\n    checkType = urlMatch[1].toLowerCase().trim();\n  } else {\n    // Versuche Query-Parameter aus URL\n    try {\n      const urlObj = new URL(url);\n      const checkTypeParam = urlObj.searchParams.get('checkType');\n      if (checkTypeParam) {\n        checkType = checkTypeParam.toLowerCase().trim();\n      }\n    } catch (e) {\n      // URL parsing fehlgeschlagen - ignoriere\n    }\n  }\n}\n\n// Step 4: Default: license (fÃ¼r Backwards Compatibility)\nif (!checkType || (checkType !== 'license' && checkType !== 'update')) {\n  checkType = 'license';\n}\n\n// Return mit checkType und allen Query-Parametern\nreturn {\n  json: {\n    ...$input.item.json,\n    checkType: checkType,\n    // Query-Parameter explizit weitergeben (Best Practice)\n    plugin: queryParams.plugin || $input.item.json.plugin || 'hero-blocks',\n    version: queryParams.version || $input.item.json.version || '1.0.0',\n    shopwareVersion: queryParams.shopwareVersion || $input.item.json.shopwareVersion || '6.7.0',\n    timestamp: queryParams.timestamp || queryParams.checkDate || $input.item.json.timestamp || new Date().toISOString(),\n    currentVersion: queryParams.currentVersion || queryParams.version || \"1.0.0\"\n  }\n};"
            },
            "id": "5052929e-a4b0-44f3-bdc4-1153020602f7",
            "name": "Code (Determine Check Type)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -2976,
                -112
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "id": "3f048ca4-29b8-4e18-866d-391fd6e15f40",
                            "leftValue": "={{ $json.checkType || $('Code (Determine Check Type)').item.json.checkType }}",
                            "rightValue": "license",
                            "operator": {
                                "type": "string",
                                "operation": "equals",
                                "name": "filter.operator.equals"
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "43505add-7da7-464e-9936-9a1b93e47477",
            "name": "IF Check Type = License?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                -2784,
                -112
            ]
        },
        {
            "parameters": {
                "values": {
                    "string": [
                        {
                            "name": "expiresAt",
                            "value": "2028-11-30T23:59:59+00:00"
                        }
                    ],
                    "number": [
                        {
                            "name": "daysRemaining",
                            "value": "={{ Math.max(0, Math.ceil((DateTime.fromISO('2027-12-30T00:00:00+00:00').toMillis() - $now.toMillis()) / 86400000)) }}"
                        }
                    ],
                    "boolean": [
                        {
                            "name": "valid",
                            "value": "={{ $now <= DateTime.fromISO('2028-11-30T23:59:59+00:00') }}"
                        }
                    ]
                },
                "options": {}
            },
            "id": "8bf99aa3-bcd6-47c9-b14b-8d67041c6ec6",
            "name": "Set (Compute License)",
            "type": "n8n-nodes-base.set",
            "typeVersion": 2,
            "position": [
                -2448,
                272
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "id": "8fbac636-c62c-49f1-8df4-e2eef67844f7",
                            "leftValue": "={{ $json.valid }}",
                            "rightValue": "",
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "2630b3d6-cb75-460c-8191-c67a89688d79",
            "name": "IF License Valid?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                -2256,
                272
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                            "leftValue": "={{ $json.valid }}",
                            "rightValue": "",
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "99e6a9bc-3a66-4ede-adeb-9429faf587a7",
            "name": "IF License Valid After Format?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                -1712,
                272
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { valid: true, expiresAt: $json.expiresAt, daysRemaining: $json.daysRemaining } }}",
                "options": {}
            },
            "id": "9dbcdf6b-e1b8-4557-824d-f08ae80a65e7",
            "name": "Respond (License Valid)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                -1472,
                176
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { valid: false, expiresAt: $json.expiresAt, daysRemaining: $json.daysRemaining } }}",
                "options": {}
            },
            "id": "45ea30c4-707c-40e2-8345-cedca5659c79",
            "name": "Respond (License Invalid)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                -1472,
                336
            ]
        },
        {
            "parameters": {
                "jsCode": "// WICHTIG: Version-Vergleich fÃ¼r Update-Check\n// Best Practices: Semantic Versioning, robust, sauber mit Error-Handling\n// Harmoniert mit GitHub Releases API Response\n\n// 1. Lese aktuelle Version aus Query-Parametern\nconst currentVersion = $input.item.json.query?.currentVersion || $input.item.json.currentVersion || \"1.0.0\";\n\n// 2. PrÃ¼fe auf GitHub API Fehler\n// WICHTIG: hasError Flag wird bereits im Process GitHub Response Node gesetzt\nconst hasError = $input.item.json.hasError === true || $input.item.json.githubError || !$input.item.json.githubTag;\n\nif (hasError) {\n  // GitHub API Fehler oder kein Release gefunden\n  // Gibt Default-Response zurÃ¼ck: available = false, latestVersion = currentVersion\n  return {\n    json: {\n      ...$input.item.json,\n      available: false,\n      currentVersion: currentVersion,\n      latestVersion: currentVersion,\n      downloadUrl: null,\n      changelog: null\n    }\n  };\n}\n\n// 3. Lese neueste Version aus GitHub Response (bereits verarbeitet)\nconst latestVersion = $input.item.json.latestVersion || currentVersion;\n\n// 4. Version-Vergleich (Semantic Versioning)\nfunction compareVersions(v1, v2) {\n  const parts1 = v1.split('.').map(Number);\n  const parts2 = v2.split('.').map(Number);\n  \n  for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n    const part1 = parts1[i] || 0;\n    const part2 = parts2[i] || 0;\n    \n    if (part1 < part2) return -1;\n    if (part1 > part2) return 1;\n  }\n  \n  return 0;\n}\n\n// 5. PrÃ¼fe ob Update verfÃ¼gbar ist\n// WICHTIG: available = true nur wenn latestVersion > currentVersion\n// Wenn latestVersion === currentVersion â†’ available = false\n// Wenn latestVersion < currentVersion â†’ available = false (bereits neueste Version)\nconst versionComparison = compareVersions(currentVersion, latestVersion);\nconst updateAvailable = latestVersion && latestVersion !== currentVersion && versionComparison < 0;\n\n// 6. Generiere Update-Informationen\n// WICHTIG: downloadUrl und changelog werden bereits aus GitHub Response extrahiert\n// WICHTIG: Gibt immer alle Felder zurÃ¼ck (auch wenn available=false), damit Shopware Admin UI korrekt angezeigt wird\nreturn {\n  json: {\n    ...$input.item.json,\n    available: updateAvailable,\n    currentVersion: currentVersion,\n    latestVersion: latestVersion,\n    // downloadUrl und changelog bereits vorhanden (aus GitHub Response)\n    downloadUrl: $input.item.json.downloadUrl || null,\n    changelog: $input.item.json.changelog || null\n  }\n};"
            },
            "id": "3658b854-61bb-4a87-b6ba-daf0ee9e4067",
            "name": "Code (Compare Versions)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -2096,
                -432
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 1
                    },
                    "conditions": [
                        {
                            "id": "81546257-bbcf-4ec4-9709-72d2c92286ae",
                            "leftValue": "={{ $json.available }}",
                            "rightValue": "true",
                            "operator": {
                                "type": "boolean",
                                "operation": "true",
                                "singleValue": true
                            }
                        }
                    ],
                    "combinator": "and"
                },
                "options": {}
            },
            "id": "36ea60cc-8aef-4d0c-8ae2-017fad18fb47",
            "name": "IF Update Available?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                -1696,
                -432
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { available: true, currentVersion: $json.currentVersion, latestVersion: $json.latestVersion, downloadUrl: $json.downloadUrl || null, changelog: $json.changelog || null, releaseId: $json.githubReleaseId || null, releaseUrl: $json.githubReleaseUrl || null } }}",
                "options": {}
            },
            "id": "75e7910b-408e-479b-86f9-7a066d2d3d60",
            "name": "Respond (Update Available)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                -1472,
                -528
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { available: false, currentVersion: $json.currentVersion || '1.0.1', latestVersion: $json.latestVersion || $json.githubTag?.replace(/^v/, '') || $json.currentVersion || '1.0.1', downloadUrl: $json.downloadUrl || null, changelog: $json.changelog || null, releaseId: $json.githubReleaseId || null, releaseUrl: $json.githubReleaseUrl || null } }}",
                "options": {}
            },
            "id": "3397d640-3544-428d-821a-3258f4601de7",
            "name": "Respond (No Update)",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                -1472,
                -352
            ]
        },
        {
            "parameters": {
                "content": "## License Check ",
                "height": 400,
                "width": 1152
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
                -2496,
                112
            ],
            "id": "beea7277-0f6c-46bb-b8e0-a152dd36c8bb",
            "name": "Sticky Note"
        },
        {
            "parameters": {
                "content": "## Update Check ",
                "height": 416,
                "width": 1152
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
                -2496,
                -560
            ],
            "id": "569c449d-b7b2-438f-9612-626a41d15237",
            "name": "Sticky Note1"
        },
        {
            "parameters": {
                "jsCode": "// WICHTIG: Verarbeite GitHub Node Response (n8n GitHub Node gibt Array zurÃ¼ck!)\n// Best Practices: Robust, sauber, eindeutige Logik mit Error-Handling\n// GemÃ¤ÃŸ n8n GitHub Node Dokumentation: Release > Get Many gibt Array zurÃ¼ck (auch bei Limit: 1)\n\n// 1. Lese GitHub Node Response\n// WICHTIG: GitHub Node gibt Array zurÃ¼ck (auch wenn nur 1 Release)\n// n8n GitHub Node gibt Releases als Array in $input.item.json zurÃ¼ck\nlet releases = $input.item.json;\n\n// PrÃ¼fe ob releases ein Array ist (GitHub Node gibt Array zurÃ¼ck)\nif (!Array.isArray(releases)) {\n  // Fallback: Versuche verschiedene Datenstrukturen\n  releases = releases.json || releases.data || (releases.items ? releases.items : [releases]);\n}\n\n// Lese currentVersion aus Query-Parametern (aus Webhook)\nconst currentVersion = $input.item.json.query?.currentVersion || $input.item.json.currentVersion || \"1.0.0\";\n\n// 2. PrÃ¼fe auf GitHub API Fehler (keine Releases, etc.)\n// WICHTIG: GitHub Node gibt leeres Array zurÃ¼ck, wenn keine Releases gefunden\nconst hasError = !Array.isArray(releases) || releases.length === 0 || !releases[0] || !releases[0].tag_name;\n\nif (hasError) {\n  // GitHub API Fehler oder kein Release gefunden\n  // Gibt Default-Response zurÃ¼ck: latestVersion = currentVersion, available = false\n  return {\n    json: {\n      ...$input.item.json,\n      latestVersion: currentVersion,\n      downloadUrl: null,\n      changelog: null,\n      currentVersion: currentVersion,\n      githubTag: null,\n      githubPublishedAt: null,\n      githubError: \"No release found\",\n      hasError: true\n    }\n  };\n}\n\n// 3. Extrahiere Latest Release (erstes Element des Arrays - GitHub sortiert nach published_at DESC)\n// WICHTIG: GitHub Node gibt Releases sortiert zurÃ¼ck (neueste zuerst)\nconst githubResponse = releases[0];\n\n// 4. Extrahiere Latest Version aus GitHub Tag\n// GitHub Tag Format: \"v1.1.0\" â†’ \"1.1.0\"\nlet latestVersion = null;\nif (githubResponse.tag_name) {\n  latestVersion = githubResponse.tag_name.replace(/^v/, \"\"); // Remove \"v\" prefix\n}\n\n// 5. Finde .zip Asset fÃ¼r Download URL\n// WICHTIG: Shopware benÃ¶tigt direkt zugÃ¤ngliche .zip URL (GitHub Releases)\n// Format: https://github.com/owner/repo/releases/download/tag/plugin-name.zip\nlet downloadUrl = null;\nif (githubResponse.assets && Array.isArray(githubResponse.assets)) {\n  // Suche nach .zip Asset (priorisiere hero-blocks-*.zip)\n  const zipAsset = githubResponse.assets.find(asset => {\n    const name = asset.name || \"\";\n    return name.endsWith('.zip') && (name.includes('hero-blocks') || name.includes('HeroBlocks'));\n  }) || githubResponse.assets.find(asset => \n    asset.name && asset.name.endsWith('.zip')\n  );\n  if (zipAsset && zipAsset.browser_download_url) {\n    downloadUrl = zipAsset.browser_download_url;\n  }\n}\n\n// Fallback: Generiere Download URL aus Release Tag (falls kein Asset vorhanden)\nif (!downloadUrl && githubResponse.tag_name && githubResponse.html_url) {\n  // GitHub Releases: /releases/tag/v1.0.0 â†’ /releases/download/v1.0.0/hero-blocks.zip\n  const tagName = githubResponse.tag_name.replace(/^v/, \"\"); // Remove \"v\" prefix\n  downloadUrl = githubResponse.html_url.replace(/\\/tag\\//, \"/download/\") + \"/hero-blocks-\" + tagName + \".zip\";\n}\n\n// 6. Extrahiere Changelog aus Release Body\nconst changelog = githubResponse.body || githubResponse.body_text || null;\n\n// 7. Extrahiere Release-ID (dynamisch fÃ¼r Shopware Update-Check)\n// WICHTIG: Release-ID wird fÃ¼r Shopware Update-Tracking benÃ¶tigt\n// GitHub API gibt Release-ID als numerischen Wert zurÃ¼ck (z.B. 12345678)\nconst releaseId = githubResponse.id || null;\nconst releaseUrl = githubResponse.html_url || null;\n\n// 8. Speichere GitHub Response Daten fÃ¼r Version-Vergleich\n// WICHTIG: Setze hasError Flag fÃ¼r explizites Error-Tracking\n// WICHTIG: Release-ID wird dynamisch extrahiert (nicht hardcoded)\nreturn {\n  json: {\n    ...$input.item.json,\n    latestVersion: latestVersion || currentVersion,\n    downloadUrl: downloadUrl || null,\n    changelog: changelog || null,\n    currentVersion: currentVersion,\n    githubTag: githubResponse.tag_name || null,\n    githubReleaseId: releaseId, // âœ… Dynamische Release-ID\n    githubReleaseUrl: releaseUrl,\n    githubPublishedAt: githubResponse.published_at || null,\n    hasError: false\n  }\n};"
            },
            "id": "a37879f1-a3cd-440b-95ee-7c029e3845ef",
            "name": "Code (Process GitHub Response)",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                -2256,
                -432
            ]
        },
        {
            "parameters": {
                "resource": "release",
                "operation": "getAll",
                "owner": {
                    "__rl": true,
                    "value": "chooomedia",
                    "mode": "list",
                    "cachedResultName": "chooomedia",
                    "cachedResultUrl": "https://github.com/chooomedia"
                },
                "repository": {
                    "__rl": true,
                    "value": "hero-blocks",
                    "mode": "list",
                    "cachedResultName": "hero-blocks",
                    "cachedResultUrl": "https://github.com/chooomedia/hero-blocks"
                }
            },
            "type": "n8n-nodes-base.github",
            "typeVersion": 1.1,
            "position": [
                -2448,
                -432
            ],
            "id": "eaae0d61-f195-40e5-a051-03cf4dcd4f1e",
            "name": "Get many releases",
            "webhookId": "be154b6c-a3ed-4c01-be7d-cd19b63163c2",
            "alwaysOutputData": true,
            "credentials": {
                "githubApi": {
                    "id": "lrNvOKmSqXVhTpHk",
                    "name": "GitHub account"
                }
            }
        },
        {
            "parameters": {
                "content": "## Update Check ",
                "height": 560,
                "width": 1136
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
                -976,
                -256
            ],
            "id": "858d49fe-1dd0-4b3b-aa07-ada242dd76c0",
            "name": "Sticky Note2"
        },
        {
            "parameters": {
                "trigger": [
                    "message"
                ],
                "channelId": {
                    "__rl": true,
                    "value": "C04347838EP",
                    "mode": "id"
                },
                "options": {}
            },
            "type": "n8n-nodes-base.slackTrigger",
            "typeVersion": 1,
            "position": [
                -912,
                176
            ],
            "id": "9e41fba5-5eb5-4733-ac97-9fd80a63e897",
            "name": "Slack Trigger1",
            "webhookId": "1731ba0a-6a8a-41f8-ac87-99dcf652799c",
            "credentials": {
                "slackApi": {
                    "id": "EtMTrc0OvEO2qFCc",
                    "name": "Slack account 2"
                }
            }
        },
        {
            "parameters": {
                "assignments": {
                    "assignments": [
                        {
                            "id": "9b2c2517-6322-45e3-acc4-2fac0b559639",
                            "name": "action",
                            "value": "delete",
                            "type": "string"
                        },
                        {
                            "id": "2e70def6-c879-4d79-b596-b35986da3d42",
                            "name": "valid",
                            "value": "={{ $json.valid }}",
                            "type": "boolean"
                        },
                        {
                            "id": "ae65dd16-3e3b-4577-8609-bc62fb5c4219",
                            "name": "userAgent",
                            "value": "={{ $json.headers[\"user-agent\"] }}",
                            "type": "string"
                        },
                        {
                            "id": "0472df79-d7b9-4acc-8c6f-f62cc4cc3415",
                            "name": "webhook",
                            "value": "={{ $json.webhookUrl }}",
                            "type": "string"
                        },
                        {
                            "id": "d0fe8c99-aa95-44e4-9910-d402a2dbca89",
                            "name": "client",
                            "value": "={{ $json.headers[\"x-forwarded-for\"] }}",
                            "type": "string"
                        }
                    ]
                },
                "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
                -1232,
                -112
            ],
            "id": "5e8e8d7b-4bdc-493a-81e7-518d95e5364f",
            "name": "valid-noupdates1"
        }
    ],
    "connections": {
        "Code (Format Slack Message - Update)": {
            "main": [
                [
                    {
                        "node": "Code (Build Slack Blocks)",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Respond (Update Available)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Format Slack Message - License)": {
            "main": [
                [
                    {
                        "node": "Code (Build Slack Blocks)",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "IF License Valid After Format?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Build Slack Blocks)": {
            "main": [
                [
                    {
                        "node": "Send Slack Message (Update)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Send Slack Message (Update)": {
            "main": [
                [
                    {
                        "node": "Code (Process Interactive Action)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Process Interactive Action)": {
            "main": [
                [
                    {
                        "node": "Respond (Slack Acknowledgment)",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "IF Action = Delete?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IF Action = Delete?": {
            "main": [
                [
                    {
                        "node": "Delete Slack Message",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Delete Slack Message": {
            "main": [
                [
                    {
                        "node": "Code (Delete Error Handler)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Webhook": {
            "main": [
                [
                    {
                        "node": "Code (Determine Check Type)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Determine Check Type)": {
            "main": [
                [
                    {
                        "node": "IF Check Type = License?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IF Check Type = License?": {
            "main": [
                [
                    {
                        "node": "Set (Compute License)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Get many releases",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Set (Compute License)": {
            "main": [
                [
                    {
                        "node": "IF License Valid?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IF License Valid?": {
            "main": [
                [
                    {
                        "node": "Code (Format Slack Message - License)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Code (Format Slack Message - License)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IF License Valid After Format?": {
            "main": [
                [
                    {
                        "node": "Respond (License Valid)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Respond (License Invalid)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Respond (License Valid)": {
            "main": [
                [
                    {
                        "node": "valid-noupdates1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Respond (License Invalid)": {
            "main": [
                [
                    {
                        "node": "Code (Build Slack Blocks)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Compare Versions)": {
            "main": [
                [
                    {
                        "node": "IF Update Available?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "IF Update Available?": {
            "main": [
                [
                    {
                        "node": "Code (Format Slack Message - Update)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Respond (No Update)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Respond (Update Available)": {
            "main": [
                [
                    {
                        "node": "Code (Build Slack Blocks)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Respond (No Update)": {
            "main": [
                [
                    {
                        "node": "valid-noupdates1",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Code (Process GitHub Response)": {
            "main": [
                [
                    {
                        "node": "Code (Compare Versions)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get many releases": {
            "main": [
                [
                    {
                        "node": "Code (Process GitHub Response)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Slack Trigger1": {
            "main": [
                [
                    {
                        "node": "Code (Process Interactive Action)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "valid-noupdates1": {
            "main": [
                [
                    {
                        "node": "Code (Build Slack Blocks)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "pinData": {},
    "meta": {
        "instanceId": "3dae61a0a24f0b093f057680559772c3c73ec97ec47a9bd2a5ad745c7d8f0365"
    }
}