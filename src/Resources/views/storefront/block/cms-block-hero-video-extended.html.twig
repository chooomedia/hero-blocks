{% block block_hero_video_extended %}
    {# ========================================
       Hero Video Extended Block
       
       Features:
       - Video upload (MP4, WebM)
       - Autoplay loop (infinite)
       - Play/Pause on scroll visibility
       - Angled text overlay (like Hero Image Overlay)
       - Scroll animation for overlay
       ======================================== #}
    
    {# Config values from block.customFields #}
    {% set videoMediaId = block.customFields.videoMediaId|default(null) %}
    {% set posterMediaId = block.customFields.posterMediaId|default(null) %}
    {% set autoplay = block.customFields.autoplay|default(true) %}
    {% set loop = block.customFields.loop|default(true) %}
    {% set muted = block.customFields.muted|default(true) %}
    {% set minHeight = block.customFields.minHeight|default('500px') %}
    
    {# Overlay settings #}
    {% set overlayPosition = block.customFields.overlayPosition|default('bottom-right') %}
    {% set overlayBackgroundColor = block.customFields.overlayBackgroundColor|default('') %}
    {% set overlayTextColor = block.customFields.overlayTextColor|default('#ffffff') %}
    {% set overlayHeadline = block.customFields.overlayHeadline|default('') %}
    {% set overlayText = block.customFields.overlayText|default('') %}
    {% set enableScrollAnimation = block.customFields.enableScrollAnimation|default(true) %}
    
    {# Build overlay styles #}
    {% set overlayBgStyle = overlayBackgroundColor ? 'background-color: ' ~ overlayBackgroundColor ~ ';' : '' %}
    {% set overlayTextStyle = overlayTextColor ? 'color: ' ~ overlayTextColor ~ ';' : '' %}
    
    {# Get video URL from media entity using hero_media_url Twig function #}
    {% set videoUrl = hero_media_url(videoMediaId) %}
    {% set posterUrl = hero_media_url(posterMediaId) %}
    
    {# Determine video type from URL extension #}
    {% set videoType = 'video/mp4' %}
    {% if videoUrl %}
        {% if '.webm' in videoUrl|lower %}
            {% set videoType = 'video/webm' %}
        {% elseif '.mp4' in videoUrl|lower %}
            {% set videoType = 'video/mp4' %}
        {% endif %}
    {% endif %}
    
    <article class="cms-block-hero-video-extended"
             style="min-height: {{ minHeight }};"
             data-hero-video-extended="true"
             data-autoplay="{{ autoplay ? 'true' : 'false' }}"
             data-loop="{{ loop ? 'true' : 'false' }}"
             data-muted="{{ muted ? 'true' : 'false' }}"
            data-pause-on-scroll="true"
            {% if enableScrollAnimation and (overlayHeadline or overlayText) %}
                data-enable-scroll-animation="true"
            {% endif %}
             itemscope
             itemtype="https://schema.org/VideoObject"
             role="region"
             aria-label="{{ overlayHeadline|striptags|default('Video') }}">
        
        {# Video Background #}
        <div class="cms-block-hero-video-extended__video-wrapper">
            {% if videoUrl %}
                {# Video element with lazy loading - MP4 und WebM Support #}
                <video 
                    class="cms-block-hero-video-extended__video"
                    {% if posterUrl %}poster="{{ posterUrl }}"{% endif %}
                    {% if autoplay %}autoplay{% endif %}
                    {% if loop %}loop{% endif %}
                    {% if muted %}muted{% endif %}
                    playsinline
                    preload="metadata"
                    data-src="{{ videoUrl }}"
                    itemprop="contentUrl">
                    <source src="{{ videoUrl }}" type="{{ videoType }}">
                    {# Fallback f체r 채ltere Browser #}
                    Ihr Browser unterst체tzt das Video-Tag nicht.
                </video>
            {% else %}
                {# Placeholder when no video #}
                <div class="cms-block-hero-video-extended__placeholder">
                    <span>Kein Video ausgew채hlt</span>
                </div>
            {% endif %}
        </div>
        
        {# Text Overlay Panel with angled edge #}
        {% if overlayHeadline or overlayText %}
            <aside class="cms-block-hero-video-extended__overlay cms-block-hero-video-extended__overlay--{{ overlayPosition }}"
                   style="{{ overlayBgStyle }} {{ overlayTextStyle }}"
                   {% if enableScrollAnimation %}
                       data-overlay-animate="true"
                   {% endif %}
                   role="complementary"
                   aria-labelledby="{{ block.id }}-headline">
                <div class="cms-block-hero-video-extended__overlay-content">
                    {% if overlayHeadline %}
                        <h2 class="cms-block-hero-video-extended__headline" 
                            id="{{ block.id }}-headline" 
                            itemprop="name" 
                            style="{{ overlayTextStyle }}">{{ overlayHeadline }}</h2>
                    {% endif %}
                    {% if overlayText %}
                        <div class="cms-block-hero-video-extended__text" 
                             itemprop="description" 
                             style="{{ overlayTextStyle }}">{{ overlayText|raw }}</div>
                    {% endif %}
                </div>
            </aside>
        {% endif %}
    </article>
{% endblock %}
