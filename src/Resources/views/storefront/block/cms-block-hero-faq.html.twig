{% block block_hero_faq %}
    {% set element = block.slots.getSlot('content') %}
    {% set config = element.config %}
    {% set faqItems = block.customFields.faqItems|default([]) %}
    {% set accordionBehavior = hero_faq_accordion_behavior(app.request.salesChannelContext.salesChannel.id) %}
    {% set openFirstItem = hero_faq_open_first_item(app.request.salesChannelContext.salesChannel.id) %}
    {% set richSnippetsEnabled = hero_faq_rich_snippets_enabled(app.request.salesChannelContext.salesChannel.id) %}
    {% set colorTheme = hero_faq_color_theme(app.request.salesChannelContext.salesChannel.id) %}

    <div class="cms-block-hero-faq cms-block-hero-faq--{{ colorTheme }}"
         data-hero-faq="true"
         data-hero-faq-options='{"accordionBehavior":"{{ accordionBehavior }}","openFirstItem":{{ openFirstItem ? 'true' : 'false' }}}'
         {% if richSnippetsEnabled and faqItems|length > 0 %}itemscope itemtype="https://schema.org/FAQPage"{% endif %}>

        {# Rich Snippets (JSON-LD) - nur wenn aktiviert #}
        {% if richSnippetsEnabled and faqItems|length > 0 %}
        <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "FAQPage",
            "mainEntity": [
                {% for faq in faqItems %}
                {
                    "@type": "Question",
                    "name": {{ faq.question|json_encode|raw }},
                    "acceptedAnswer": {
                        "@type": "Answer",
                        "text": {{ faq.answer|striptags|json_encode|raw }}
                    }
                }{% if not loop.last %},{% endif %}
                {% endfor %}
            ]
        }
        </script>
        {% endif %}

        <div class="cms-block-hero-faq__content">
            {% if faqItems|length > 0 %}
                {# Bootstrap Accordion-Style FAQ #}
                <div class="accordion" id="faq-accordion-{{ block.id }}">
                    {% for faq in faqItems %}
                        <div class="cms-block-hero-faq__content-item" 
                             {% if richSnippetsEnabled %}itemscope itemprop="mainEntity" itemtype="https://schema.org/Question"{% endif %}>
                            
                            {# FAQ Question Button - Bootstrap btn + custom dark/light bg #}
                            <button class="btn w-100 text-start d-flex align-items-center p-3 border-bottom border-white rounded-0 faq-question-btn {% if colorTheme == 'dark' %}bg-dark text-white{% else %}bg-light text-dark{% endif %}"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#faq-answer-{{ block.id }}-{{ loop.index }}"
                                    aria-expanded="{{ (openFirstItem and loop.first) ? 'true' : 'false' }}"
                                    aria-controls="faq-answer-{{ block.id }}-{{ loop.index }}"
                                    style="transition: all 0.3s ease; min-height: 56px; {% if colorTheme == 'dark' %}background-color: #4a4a4a;{% endif %}">
                                
                                <span class="faq-question-text flex-grow-1 me-2" {% if richSnippetsEnabled %}itemprop="name"{% endif %}>
                                    {{ faq.question }}
                                </span>
                                
                                {# Plus Icon (rotates to X when open) #}
                                <svg class="faq-icon-toggle" 
                                     width="20" 
                                     height="20" 
                                     viewBox="0 0 24 24" 
                                     fill="none" 
                                     stroke="currentColor" 
                                     stroke-width="2.5" 
                                     stroke-linecap="round" 
                                     stroke-linejoin="round"
                                     style="transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);"
                                     aria-hidden="true">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            
                            {# FAQ Answer - Bootstrap collapse #}
                            <div id="faq-answer-{{ block.id }}-{{ loop.index }}"
                                 class="collapse {% if openFirstItem and loop.first %}show{% endif %}"
                                 data-bs-parent="{% if accordionBehavior == 'single' %}#faq-accordion-{{ block.id }}{% endif %}"
                                 {% if richSnippetsEnabled %}itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"{% endif %}>
                                <div class="p-3 bg-white faq-answer-content"
                                     {% if richSnippetsEnabled %}itemprop="text"{% endif %}>
                                    {{ faq.answer|raw }}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                {# Fallback für leere FAQ-Liste #}
                <div class="text-center py-5">
                    <p class="text-muted">{{ 'component.cms.faq.empty.description'|trans }}</p>
                </div>
            {% endif %}
        </div>
        
        {# Inline CSS für Icon-Rotation und Hover-Effekte #}
        <style>
            /* WICHTIG: Kein Bootstrap Grid Padding! */
            .cms-block-hero-faq {
                padding-left: 0 !important;
                padding-right: 0 !important;
                max-width: 100% !important;
            }
            
            /* Icon-Rotation: Plus → X */
            [data-bs-toggle="collapse"][aria-expanded="true"] svg {
                transform: rotate(45deg) !important;
            }
            
            /* Dark Theme Hover */
            .cms-block-hero-faq--dark .faq-question-btn {
                background-color: #4a4a4a !important;
            }
            .cms-block-hero-faq--dark .faq-question-btn:hover {
                background-color: #5a5a5a !important;
            }
            .cms-block-hero-faq--dark .faq-question-btn:hover .faq-question-text {
                color: var(--danger, #dc3545) !important; /* Theme-Rot */
            }
            .cms-block-hero-faq--dark .faq-question-btn:hover svg {
                stroke: var(--danger, #dc3545) !important; /* SVG Icon wird auch rot */
            }
            
            /* Light Theme Hover */
            .cms-block-hero-faq--light .faq-question-btn {
                background-color: #f8f9fa !important;
            }
            .cms-block-hero-faq--light .faq-question-btn:hover {
                background-color: #e9ecef !important;
            }
            .cms-block-hero-faq--light .faq-question-btn:hover .faq-question-text {
                color: var(--danger, #dc3545) !important; /* Theme-Rot */
            }
            .cms-block-hero-faq--light .faq-question-btn:hover svg {
                stroke: var(--danger, #dc3545) !important; /* SVG Icon wird auch rot */
            }
            
            /* Answer Border - sichtbar in gleicher Farbe wie Question-Background */
            .faq-answer-content {
                border: 1px solid #4a4a4a !important;
                word-wrap: break-word;
                overflow-wrap: break-word;
                word-break: break-word;
                hyphens: auto;
            }
            
            /* Links in Answer - Theme-Farbe */
            .faq-answer-content a {
                color: var(--primary, #0563c1) !important;
                text-decoration: underline;
            }
            .faq-answer-content a:hover {
                color: var(--danger, #dc3545) !important;
            }
            
            /* Text und Icon Styling */
            .faq-question-text {
                flex: 1 1 auto;
                max-width: calc(100% - 44px); /* Platz für Icon (20px) + margin (24px) */
                word-wrap: break-word !important;
                overflow-wrap: break-word !important;
                word-break: break-word;
                hyphens: auto;
                line-height: 1.3;
                white-space: normal !important; /* WICHTIG: Text darf umbrechen */
            }
            
            .faq-icon-toggle {
                flex: 0 0 20px; /* Feste Breite */
                width: 20px;
                height: 20px;
                flex-shrink: 0; /* WICHTIG: Icon darf nicht schrumpfen */
                margin-left: 1rem;
            }
            
            /* Mobile Optimierung: Text-Umbruch und Icon-Zentrierung */
            @media (max-width: 767px) {
                .faq-question-btn {
                    min-height: 64px !important;
                    padding: 1rem !important;
                    align-items: flex-start !important; /* Icon oben ausrichten bei mehrzeiligem Text */
                }
                
                .faq-question-text {
                    max-width: calc(100% - 32px) !important; /* Weniger Platz auf Mobile */
                    margin-right: 0.5rem !important;
                    font-size: 0.95rem !important;
                    padding-top: 2px; /* Optische Zentrierung */
                }
                
                .faq-icon-toggle {
                    width: 20px !important;
                    height: 20px !important;
                    flex: 0 0 20px !important;
                    flex-shrink: 0 !important;
                    margin-top: 2px; /* Icon leicht nach unten für bessere Optik */
                }
            }
            
            /* Extra-Small Mobile (iPhone SE, etc.) */
            @media (max-width: 375px) {
                .faq-question-btn {
                    padding: 0.875rem !important;
                    min-height: 60px !important;
                }
                
                .faq-question-text {
                    max-width: calc(100% - 28px) !important;
                    font-size: 0.875rem !important;
                    margin-right: 0.5rem !important;
                }
                
                .faq-icon-toggle {
                    width: 18px !important;
                    height: 18px !important;
                    flex: 0 0 18px !important;
                }
            }
        </style>
    </div>
{% endblock %}
