{#
    Hero Image Overlay Block
    
    Features:
    - Full-width background image
    - Angled text overlay panel (33Â° angle)
    - Position: top-left, middle-left, bottom-left, top-right, middle-right, bottom-right
    - Scroll animation from outside (per section, triggered when scrolled into view)
    - Uses theme accent color for overlay background
    - Responsive design with angle preserved on mobile
    - Full accessibility support (ARIA, Schema.org)
#}

{% block block_hero_image_overlay %}
    {# Read block configuration from customFields #}
    {% set overlayPosition = block.customFields.overlayPosition|default('top-left') %}
    {% set overlayBackgroundColor = block.customFields.overlayBackgroundColor|default('') %}
    {% set overlayTextColor = block.customFields.overlayTextColor|default('#ffffff') %}
    {% set overlayHeadline = block.customFields.overlayHeadline|default('') %}
    {% set overlayText = block.customFields.overlayText|default('') %}
    {% set enableScrollAnimation = block.customFields.enableScrollAnimation|default(true) %}
    {% set minHeight = block.customFields.minHeight|default('500px') %}
    
    {# Determine position classes #}
    {% set isLeftPosition = 'left' in overlayPosition %}
    {% set isRightPosition = 'right' in overlayPosition %}
    {% set isTopPosition = 'top' in overlayPosition %}
    {% set isMiddlePosition = 'middle' in overlayPosition %}
    {% set isBottomPosition = 'bottom' in overlayPosition %}
    
    {# Build overlay styles - nur setzen wenn explizit definiert #}
    {# Wenn leer, wird CSS var(--sw-color-accent) als Fallback verwendet #}
    {% set overlayBgStyle = overlayBackgroundColor ? 'background-color: ' ~ overlayBackgroundColor ~ ';' : '' %}
    {% set overlayTextStyle = overlayTextColor ? 'color: ' ~ overlayTextColor ~ ';' : '' %}
    
    {# Unique ID for accessibility #}
    {% set blockId = 'hero-overlay-' ~ random() %}
    
    {# 
        Main Container
        - itemscope/itemtype for Schema.org (ImageObject with text overlay)
        - role="region" for landmark navigation
        - aria-label for screen readers
    #}
    <article class="cms-block-hero-image-overlay"
             style="min-height: {{ minHeight }};"
             itemscope
             itemtype="https://schema.org/ImageObject"
             role="region"
             aria-label="{{ overlayHeadline|default('Hero Image with Text Overlay')|striptags }}"
             {% if enableScrollAnimation %}
                 data-hero-image-overlay="true"
                 data-overlay-position="{{ overlayPosition }}"
             {% endif %}>
        
        {# Background Image (from slot) #}
        <div class="cms-block-hero-image-overlay__image"
             role="img"
             aria-hidden="true">
            {% set element = block.slots.getSlot('image') %}
            {% if element and element.type %}
                {% sw_include '@Storefront/storefront/element/cms-element-' ~ element.type ~ '.html.twig' ignore missing %}
            {% endif %}
        </div>
        
        {# 
            Text Overlay Panel
            - role="banner" for important promotional content
            - aria-labelledby references the headline
        #}
        <aside class="cms-block-hero-image-overlay__overlay cms-block-hero-image-overlay__overlay--{{ overlayPosition }}"
               style="{{ overlayBgStyle }} {{ overlayTextStyle }}"
               role="complementary"
               aria-labelledby="{{ blockId }}-headline"
               {% if enableScrollAnimation %}
                   data-overlay-animate="true"
               {% endif %}>
            <div class="cms-block-hero-image-overlay__overlay-content">
                {% if overlayHeadline %}
                    {# Headline mit expliziter Text-Farbe aus Admin-Settings #}
                    <h2 class="cms-block-hero-image-overlay__headline" 
                        id="{{ blockId }}-headline"
                        itemprop="name"
                        style="{{ overlayTextStyle }}">{{ overlayHeadline }}</h2>
                {% endif %}
                {% if overlayText %}
                    {# Text mit expliziter Text-Farbe aus Admin-Settings #}
                    <div class="cms-block-hero-image-overlay__text" 
                         itemprop="description"
                         style="{{ overlayTextStyle }}">{{ overlayText|raw }}</div>
                {% endif %}
                {# Fallback: Show placeholder if no content is defined (only in preview/dev) #}
                {% if not overlayHeadline and not overlayText %}
                    <h2 class="cms-block-hero-image-overlay__headline" 
                        id="{{ blockId }}-headline"
                        style="{{ overlayTextStyle }}">Your Headline</h2>
                    <p class="cms-block-hero-image-overlay__text" 
                       style="{{ overlayTextStyle }}">Your description text here</p>
                {% endif %}
            </div>
        </aside>
        
        {# Hidden metadata for Schema.org #}
        <meta itemprop="contentUrl" content="{{ element.data.media.url|default('') }}">
    </article>
{% endblock %}

