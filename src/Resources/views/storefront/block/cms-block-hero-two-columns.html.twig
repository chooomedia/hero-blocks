{% block block_hero_two_columns %}
    {# WICHTIG: Config-Werte aus block.customFields lesen (NICHT block.config!) #}
    {# CmsBlockEntity nutzt EntityCustomFieldsTrait - Config wird in customFields gespeichert #}
    
    {# WICHTIG: License-Hinweis wird ZENTRAL angezeigt (page/content/index.html.twig) #}
    {# NICHT mehr hier pro Block - verhindert Duplicates! #}
    
    {% set layout = (block.customFields.layout is defined and block.customFields.layout is not empty) ? block.customFields.layout : 'image-left' %}
    {% set layoutDesktop = (block.customFields.layoutDesktop is defined and block.customFields.layoutDesktop is not empty) ? block.customFields.layoutDesktop : layout %}
    {% set layoutTablet = (block.customFields.layoutTablet is defined and block.customFields.layoutTablet is not empty) ? block.customFields.layoutTablet : layout %}
    {% set backgroundMode = (block.customFields.backgroundMode is defined) ? block.customFields.backgroundMode : 'none' %}
    
    {# WICHTIG: minHeight nur setzen wenn es existiert UND nicht calc(100vh...) enthält #}
    {# calc(100vh...) Werte werden ignoriert (werden nur bei fullHeight verwendet) #}
    {% set minHeight = null %}
    {% if block.customFields.minHeight is defined and block.customFields.minHeight is not null and block.customFields.minHeight is not empty %}
        {% set minHeightValue = block.customFields.minHeight|trim %}
        {# WICHTIG: Ignoriere calc(100vh...) Werte - diese werden nur bei fullHeight verwendet #}
        {% if minHeightValue|length > 0 and 'calc(100vh' not in minHeightValue %}
            {% set minHeight = minHeightValue %}
        {% endif %}
    {% endif %}
    
    {# Background Images - WICHTIG: Media-URLs korrekt generieren #}
    {% set backgroundImage = (block.customFields.backgroundImage is defined) ? block.customFields.backgroundImage : null %}
    {% set backgroundImageLeft = (block.customFields.backgroundImageLeft is defined) ? block.customFields.backgroundImageLeft : null %}
    {% set backgroundImageRight = (block.customFields.backgroundImageRight is defined) ? block.customFields.backgroundImageRight : null %}
    {% set backgroundZIndex = (block.customFields.backgroundZIndex is defined) ? block.customFields.backgroundZIndex : '0' %}
    
    {# Background CSS Code Toggle #}
    {% set backgroundLeftUseCss = (block.customFields.backgroundLeftUseCss is defined) ? block.customFields.backgroundLeftUseCss : false %}
    {% set backgroundRightUseCss = (block.customFields.backgroundRightUseCss is defined) ? block.customFields.backgroundRightUseCss : false %}
    {# WICHTIG: Gradient endet mit Farbe statt transparent (verhindert dunklen Rand am Ende) #}
    {% set backgroundLeftCss = (block.customFields.backgroundLeftCss is defined and block.customFields.backgroundLeftCss is not empty) ? block.customFields.backgroundLeftCss : 'clip-path: polygon(0px 0px, 100% 0%, 16% 100%, 0% 100%);
background: repeating-linear-gradient(123deg, rgba(214, 171, 96, 0.5) 0px, rgba(214, 171, 96, 0.5) 6px, transparent 6px, transparent 12px, rgba(214, 171, 96, 0.5) 12px, rgba(214, 171, 96, 0.5) 13px);
max-width: 30vw;' %}
    {% set backgroundRightCss = (block.customFields.backgroundRightCss is defined and block.customFields.backgroundRightCss is not empty) ? block.customFields.backgroundRightCss : 'clip-path: polygon(84% 0%, 100% 0%, 100% 100%, 0% 100%);
background: repeating-linear-gradient(123deg, rgba(214, 171, 96, 0.5) 0px, rgba(214, 171, 96, 0.5) 6px, transparent 6px, transparent 12px, rgba(214, 171, 96, 0.5) 12px, rgba(214, 171, 96, 0.5) 13px);
max-width: 30vw;' %}
    
    {# Scroll Animation Settings #}
    {% set scrollAnimationAngle = (block.customFields.scrollAnimationAngle is defined and block.customFields.scrollAnimationAngle is not empty) ? block.customFields.scrollAnimationAngle : '33' %}
    {% set scrollAnimationEnabled = (block.customFields.scrollAnimationEnabled is defined) ? block.customFields.scrollAnimationEnabled : true %}
    
    {# Media-URLs generieren mit Twig Extension (nur wenn nicht CSS Code verwendet wird) #}
    {% set backgroundImageUrl = backgroundImage ? hero_media_url(backgroundImage) : null %}
    {% set backgroundImageLeftUrl = (backgroundLeftUseCss == false and backgroundImageLeft) ? hero_media_url(backgroundImageLeft) : null %}
    {% set backgroundImageRightUrl = (backgroundRightUseCss == false and backgroundImageRight) ? hero_media_url(backgroundImageRight) : null %}
    
    {# Audio-Datei #}
    {% set audioFile = (block.customFields.audioFile is defined) ? block.customFields.audioFile : null %}
    {% set audioFileUrl = audioFile ? hero_media_url(audioFile) : null %}
    
    {# Element Positionierung - Left Slot #}
    {% set elementLeftTranslateX = (block.customFields.elementLeftTranslateX is defined) ? block.customFields.elementLeftTranslateX : '0' %}
    {% set elementLeftTranslateY = (block.customFields.elementLeftTranslateY is defined) ? block.customFields.elementLeftTranslateY : '0' %}
    {% set elementLeftAnimate = (block.customFields.elementLeftAnimate is defined) ? block.customFields.elementLeftAnimate : false %}
    {% set elementLeftCss = (block.customFields.elementLeftCss is defined and block.customFields.elementLeftCss is not empty) ? block.customFields.elementLeftCss : '' %}
    
    {# Element Positionierung - Right Slot #}
    {% set elementRightTranslateX = (block.customFields.elementRightTranslateX is defined) ? block.customFields.elementRightTranslateX : '0' %}
    {% set elementRightTranslateY = (block.customFields.elementRightTranslateY is defined) ? block.customFields.elementRightTranslateY : '0' %}
    {% set elementRightAnimate = (block.customFields.elementRightAnimate is defined) ? block.customFields.elementRightAnimate : false %}
    {% set elementRightCss = (block.customFields.elementRightCss is defined and block.customFields.elementRightCss is not empty) ? block.customFields.elementRightCss : '' %}
    
    {# Image Container CSS (für .cms-image-container) #}
    {% set imageContainerLeftCss = (block.customFields.imageContainerLeftCss is defined and block.customFields.imageContainerLeftCss is not empty) ? block.customFields.imageContainerLeftCss : '' %}
    {% set imageContainerRightCss = (block.customFields.imageContainerRightCss is defined and block.customFields.imageContainerRightCss is not empty) ? block.customFields.imageContainerRightCss : '' %}

    {# WICHTIG: Background-Bilder werden auf .cms-block Level gerendert (wie Standard-Block) #}
    {# Background Mode: Single Image #}
    {% if backgroundMode == 'single' and backgroundImageUrl %}
            <div class="hero-two-columns-background hero-two-columns-background--single" 
             style="background-image: url('{{ backgroundImageUrl }}'); z-index: {{ backgroundZIndex }};">
            </div>
    {% endif %}

    {# Background Mode: Two Images (Parallax) #}
    {% if backgroundMode == 'two-images' %}
            {# Background Left: Image oder CSS Code #}
            {% if backgroundLeftUseCss %}
                {# WICHTIG: CSS Code mit z-index kombinieren #}
                {% set backgroundLeftStyle = backgroundLeftCss|trim %}
                {% if backgroundLeftStyle|slice(-1) != ';' %}
                    {% set backgroundLeftStyle = backgroundLeftStyle ~ ';' %}
                {% endif %}
                {% set backgroundLeftStyle = backgroundLeftStyle ~ ' z-index: ' ~ backgroundZIndex ~ ';' %}
                <div class="hero-two-columns-background hero-two-columns-background--left" 
                     {% if scrollAnimationEnabled %}data-parallax-background="left"{% endif %}
                     data-scroll-animation-angle="{{ scrollAnimationAngle }}"
                     data-scroll-animation-enabled="{{ scrollAnimationEnabled ? 'true' : 'false' }}"
                     style="{{ backgroundLeftStyle|raw }}">
                </div>
            {% elseif backgroundImageLeftUrl %}
                <div class="hero-two-columns-background hero-two-columns-background--left" 
                     {% if scrollAnimationEnabled %}data-parallax-background="left"{% endif %}
                     data-scroll-animation-angle="{{ scrollAnimationAngle }}"
                     data-scroll-animation-enabled="{{ scrollAnimationEnabled ? 'true' : 'false' }}"
                     style="background-image: url('{{ backgroundImageLeftUrl }}'); z-index: {{ backgroundZIndex }};">
                </div>
            {% endif %}
            
            {# Background Right: Image oder CSS Code #}
            {% if backgroundRightUseCss %}
                {# WICHTIG: CSS Code mit z-index kombinieren #}
                {% set backgroundRightStyle = backgroundRightCss|trim %}
                {% if backgroundRightStyle|slice(-1) != ';' %}
                    {% set backgroundRightStyle = backgroundRightStyle ~ ';' %}
                {% endif %}
                {% set backgroundRightStyle = backgroundRightStyle ~ ' z-index: ' ~ backgroundZIndex ~ ';' %}
                <div class="hero-two-columns-background hero-two-columns-background--right" 
                     {% if scrollAnimationEnabled %}data-parallax-background="right"{% endif %}
                     data-scroll-animation-angle="{{ scrollAnimationAngle }}"
                     data-scroll-animation-enabled="{{ scrollAnimationEnabled ? 'true' : 'false' }}"
                     style="{{ backgroundRightStyle|raw }}">
                </div>
            {% elseif backgroundImageRightUrl %}
                <div class="hero-two-columns-background hero-two-columns-background--right" 
                     {% if scrollAnimationEnabled %}data-parallax-background="right"{% endif %}
                     data-scroll-animation-angle="{{ scrollAnimationAngle }}"
                     data-scroll-animation-enabled="{{ scrollAnimationEnabled ? 'true' : 'false' }}"
                     style="background-image: url('{{ backgroundImageRightUrl }}'); z-index: {{ backgroundZIndex }};">
                </div>
            {% endif %}
    {% endif %}

    {# WICHTIG: Bei full-width Section: Container um Content-Elemente für innere Breite #}
    {% set isFullWidth = section.sizingMode == 'full_width' %}
    {% if isFullWidth %}
        <div class="container hero-two-columns-content-container">
            <div class="row">
    {% endif %}
    
    {# WICHTIG: Cols müssen direkte Kinder der .row sein (wie Standard image-text Block) #}
    {# Desktop/Tablet: 2 Spalten (50/50), Mobile: Stacked (100%) #}
    {% block block_hero_two_columns_content %}
        {# Left Slot (Bild) - Direktes Kind der .row für Bootstrap Grid #}
        {% block block_hero_two_columns_left %}
            {% set element = block.slots.getSlot('left') %}
            {% if element and element.type %}
                {# WICHTIG: Bootstrap Order-Klassen für Responsive Layout #}
                {# layout: Mobile, layoutTablet: Tablet, layoutDesktop: Desktop #}
                {% set mobileOrder = layout == 'text-left' ? '2' : '1' %}
                {% set tabletOrder = layoutTablet == 'text-left' ? '2' : '1' %}
                {% set desktopOrder = layoutDesktop == 'text-left' ? '2' : '1' %}
                {% set orderClasses = 'order-' ~ mobileOrder ~ ' order-md-' ~ tabletOrder ~ ' order-lg-' ~ desktopOrder %}
                
                {# WICHTIG: min-height nur auf Desktop (nicht Mobile) via CSS-Klasse #}
                <div class="col-md-6 {{ orderClasses }}" data-cms-element-id="{{ element.id }}" {% if minHeight %}data-min-height="{{ minHeight }}"{% endif %}>
                    {% block block_hero_two_columns_left_inner %}
                        {# WICHTIG: Wrapper für Element-Positionierung und Animation #}
                        {# Custom CSS nur auf Desktop anwenden (via data-Attribut für JS/CSS) #}
                        <div class="hero-two-columns-element-wrapper hero-two-columns-element-wrapper--left"
                             {% if elementLeftAnimate %}data-scroll-animate="true"{% endif %}
                             data-translate-x="{{ elementLeftTranslateX }}"
                             data-translate-y="{{ elementLeftTranslateY }}"
                             {% if elementLeftCss %}data-custom-css="{{ elementLeftCss|e('html_attr') }}"{% endif %}
                             {% if imageContainerLeftCss %}data-image-container-css="{{ imageContainerLeftCss|e('html_attr') }}"{% endif %}>
                            {% sw_include '@Storefront/storefront/element/cms-element-' ~ element.type ~ '.html.twig' ignore missing %}
                        </div>
                    {% endblock %}
                    </div>
            {% endif %}
        {% endblock %}

        {# Right Slot (Text) - Direktes Kind der .row für Bootstrap Grid #}
        {% block block_hero_two_columns_right %}
            {% set element = block.slots.getSlot('right') %}
            {% if element and element.type %}
                {# WICHTIG: Bootstrap Order-Klassen für Responsive Layout (invers zu left) #}
                {% set mobileOrder = layout == 'text-left' ? '1' : '2' %}
                {% set tabletOrder = layoutTablet == 'text-left' ? '1' : '2' %}
                {% set desktopOrder = layoutDesktop == 'text-left' ? '1' : '2' %}
                {% set orderClasses = 'order-' ~ mobileOrder ~ ' order-md-' ~ tabletOrder ~ ' order-lg-' ~ desktopOrder %}
                
                {# WICHTIG: min-height nur auf Desktop (nicht Mobile) via CSS-Klasse #}
                <div class="col-md-6 {{ orderClasses }}" data-cms-element-id="{{ element.id }}" {% if minHeight %}data-min-height="{{ minHeight }}"{% endif %}>
                    {% block block_hero_two_columns_right_inner %}
                        {# WICHTIG: Wrapper für Element-Positionierung und Animation #}
                        {# Custom CSS nur auf Desktop anwenden (via data-Attribut für JS/CSS) #}
                        <div class="hero-two-columns-element-wrapper hero-two-columns-element-wrapper--right"
                             {% if elementRightAnimate %}data-scroll-animate="true"{% endif %}
                             data-translate-x="{{ elementRightTranslateX }}"
                             data-translate-y="{{ elementRightTranslateY }}"
                             {% if elementRightCss %}data-custom-css="{{ elementRightCss|e('html_attr') }}"{% endif %}
                             {% if imageContainerRightCss %}data-image-container-css="{{ imageContainerRightCss|e('html_attr') }}"{% endif %}>
                            {% sw_include '@Storefront/storefront/element/cms-element-' ~ element.type ~ '.html.twig' ignore missing %}
                        </div>
                    {% endblock %}
                    </div>
            {% endif %}
        {% endblock %}
    {% endblock %}
    
    {# WICHTIG: Bei full-width Section: Container schließen #}
    {% if isFullWidth %}
            </div> {# row #}
        </div> {# container #}
    {% endif %}
    
    {# ============================================================================
       ANIMATION HINWEIS:
       Die Animation wird vom HeroTwoColumnsScrollAnimationPlugin übernommen
       (registriert in HorexShopTheme/src/Resources/app/storefront/src/main.js)
       
       ANIMATION LOGIK:
       - Links: Startet von UNTEN-LINKS (außerhalb), endet OBEN-LINKS (mit Überstand)
       - Rechts: Startet von OBEN-RECHTS (außerhalb), endet UNTEN-RECHTS (mit Überstand)
       - Bewegung: Diagonal im 33° Winkel (90° - 33° = 57° von horizontal)
       - KEINE Rotation des Elements selbst - die Streifen sind bereits diagonal (via CSS)
       ============================================================================ #}
{% endblock %}
