{% sw_extends '@Storefront/storefront/section/cms-section-block-container.html.twig' %}

{% block section_content_block_container %}
    {# WICHTIG: Container-Klasse für hero-two-columns Block bei full-width Section #}
    {% set isFullWidth = section.sizingMode == 'full_width' %}
    {% set isHeroTwoColumns = block.type == 'hero-two-columns' %}
    {% set containerClass = 'cms-block-container' %}
    
    {# WICHTIG: Kein Padding bei full-width und hero-two-columns #}
    {% set shouldHavePadding = padding and not (isFullWidth and isHeroTwoColumns) %}
    
    {# WICHTIG: Inline-Style für full-width ohne padding #}
    {% set containerStyle = '' %}
    {% if shouldHavePadding %}
        {% set containerStyle = containerStyle ~ 'padding: ' ~ padding ~ ';' %}
    {% elseif isFullWidth and isHeroTwoColumns %}
        {# WICHTIG: KEIN padding, margin für full-width! #}
        {% set containerStyle = containerStyle ~ 'padding: 0; margin: 0; max-width: 100%; width: 100%;' %}
    {% endif %}
    
    <div class="{{ containerClass }}"
         {% if isHeroTwoColumns %}data-hero-two-columns-parallax="true"{% endif %}
         {% if containerStyle %}style="{{ containerStyle }}"{% endif %}>
        {% block section_content_block_row %}
            {# WICHTIG: .row immer rendern außer bei full-width + hero-two-columns #}
            {% if not (isFullWidth and isHeroTwoColumns) %}
                <div class="cms-block-container-row row cms-row {{ sidebarClasses }}">
            {% endif %}
            
            {% sw_include '@Storefront/storefront/block/cms-block-' ~ block.type ~ '.html.twig' ignore missing %}
            
            {% if not (isFullWidth and isHeroTwoColumns) %}
                </div>
            {% endif %}
        {% endblock %}
        
        {# WICHTIG: Audio-Icon außerhalb der .row rendern (nur für hero-two-columns) #}
        {% if isHeroTwoColumns and block.customFields.audioFile is defined and block.customFields.audioFile %}
            {% set audioFileUrl = hero_media_url(block.customFields.audioFile) %}
            {% if audioFileUrl %}
                <div class="hero-two-columns-audio-wrapper">
                    <button class="hero-two-columns-audio-button" 
                            type="button"
                            aria-label="Audio abspielen"
                            data-audio-url="{{ audioFileUrl }}">
                        <svg class="hero-two-columns-audio-icon" width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="24" cy="24" r="23" stroke="currentColor" stroke-width="2"/>
                            <path d="M18 16C18 15.4477 18.4477 15 19 15H23C23.5523 15 24 15.4477 24 16V32C24 32.5523 23.5523 33 23 33H19C18.4477 33 18 32.5523 18 32V16Z" fill="currentColor"/>
                            <path d="M24 20L30 18V30L24 28V20Z" fill="currentColor"/>
                            <path d="M32 18C32 18 34 20 34 24C34 28 32 30 32 30" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M36 16C36 16 38 18 38 24C38 30 36 32 36 32" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </button>
                    <audio class="hero-two-columns-audio-element" preload="none">
                        <source src="{{ audioFileUrl }}" type="audio/mpeg">
                        <source src="{{ audioFileUrl }}" type="audio/ogg">
                        Ihr Browser unterstützt das Audio-Element nicht.
                    </audio>
                </div>
            {% endif %}
        {% endif %}
    </div>
{% endblock %}
