{% block sw_system_config %}
<div class="sw-system-config">
    <div
        v-if="salesChannelSwitchable && config.length > 1"
        class="sw-system-config__global-sales-channel-switch"
    >
        <sw-sales-channel-switch
            :label="$tc('sw-settings.system-config.labelSalesChannelSelect')"
            @change-sales-channel-id="onSalesChannelChanged"
        />
    </div>
    
    {% block sw_system_config_content_card %}
    {# Hero Blocks Description - Vor allen Cards, AUSSERHALB der v-for Schleife #}
    <div v-if="isHeroBlocksConfig()" class="sw-system-config__hero-blocks-description">
        <p class="sw-system-config__hero-blocks-description-text">
            {{ $tc('sw-settings-license-check.description') }}
        </p>
        
        {# Feature Grid - Modern minimalist design (ohne Icons) #}
        <div class="sw-system-config__hero-blocks-features">
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--active">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.heroSlider') }}</div>
                </div>
            </div>
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--active">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.heroTwoColumns') }}</div>
                </div>
            </div>
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--inactive">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.heroVideoExtended') }}</div>
                </div>
            </div>
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--inactive">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.heroInstagramFeed') }}</div>
                </div>
            </div>
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--inactive">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.megaMenu') }}</div>
                </div>
            </div>
            <div class="sw-system-config__hero-blocks-feature-item sw-system-config__hero-blocks-feature-item--inactive">
                <div class="sw-system-config__hero-blocks-feature-content">
                    <div class="sw-system-config__hero-blocks-feature-title">{{ $tc('sw-settings-license-check.features.shoppingExperience') }}</div>
                </div>
            </div>
        </div>
        
        {# Animations Section - CSS Klassen Hinweise #}
        <div class="sw-system-config__hero-blocks-animations">
            <h4 class="sw-system-config__hero-blocks-animations-title">
                <mt-icon name="regular-play-circle" size="18" />
                {{ $tc('sw-settings-license-check.animations.title') }}
            </h4>
            <p class="sw-system-config__hero-blocks-animations-description">
                {{ $tc('sw-settings-license-check.animations.description') }}
            </p>
            
            <div class="sw-system-config__hero-blocks-animations-grid">
                {# Scroll Slide Animation #}
                <div class="sw-system-config__hero-blocks-animation-card">
                    <div class="sw-system-config__hero-blocks-animation-header">
                        <code class="sw-system-config__hero-blocks-animation-class">{{ $tc('sw-settings-license-check.animations.scrollSlide.name') }}</code>
                    </div>
                    <p class="sw-system-config__hero-blocks-animation-desc">
                        {{ $tc('sw-settings-license-check.animations.scrollSlide.description') }}
                    </p>
                </div>
                
                {# Count Up Animation #}
                <div class="sw-system-config__hero-blocks-animation-card">
                    <div class="sw-system-config__hero-blocks-animation-header">
                        <code class="sw-system-config__hero-blocks-animation-class">{{ $tc('sw-settings-license-check.animations.countUp.name') }}</code>
                    </div>
                    <p class="sw-system-config__hero-blocks-animation-desc">
                        {{ $tc('sw-settings-license-check.animations.countUp.description') }}
                    </p>
                </div>
            </div>
            
            {# Usage Steps #}
            <div class="sw-system-config__hero-blocks-animations-usage">
                <h5 class="sw-system-config__hero-blocks-animations-usage-title">
                    {{ $tc('sw-settings-license-check.animations.usage.title') }}
                </h5>
                <ol class="sw-system-config__hero-blocks-animations-usage-steps">
                    <li>{{ $tc('sw-settings-license-check.animations.usage.step1') }}</li>
                    <li>{{ $tc('sw-settings-license-check.animations.usage.step2') }}</li>
                    <li>{{ $tc('sw-settings-license-check.animations.usage.step3') }}</li>
                    <li>{{ $tc('sw-settings-license-check.animations.usage.step4') }}</li>
                </ol>
            </div>
            
            {# Count-Up Options (Collapsible) #}
            <sw-collapse :expand-on-loading="false" class="sw-system-config__hero-blocks-animations-options">
                <template #header="{ expanded }">
                    <div class="sw-system-config__hero-blocks-animations-options-header">
                        <span>{{ $tc('sw-settings-license-check.animations.countUpOptions.title') }}</span>
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="14"
                        />
                    </div>
                </template>
                <template #content>
                    <ul class="sw-system-config__hero-blocks-animations-options-list">
                        <li><code>{{ $tc('sw-settings-license-check.animations.countUpOptions.dataTarget') }}</code></li>
                        <li><code>{{ $tc('sw-settings-license-check.animations.countUpOptions.dataSuffix') }}</code></li>
                        <li><code>{{ $tc('sw-settings-license-check.animations.countUpOptions.dataPrefix') }}</code></li>
                        <li><code>{{ $tc('sw-settings-license-check.animations.countUpOptions.dataDuration') }}</code></li>
                        <li><code>{{ $tc('sw-settings-license-check.animations.countUpOptions.dataDecimals') }}</code></li>
                    </ul>
                </template>
            </sw-collapse>
        </div>
    </div>
    
    <template v-for="card, index in config" :key="index">
        {# Index 0: Block Settings - Standard Card (IMMER ANZEIGEN) #}
        <mt-card
            v-if="isHeroBlocksConfig() && index === 0"
            position-identifier="sw-system-config-content"
            :class="`sw-system-config__card--${index}`"
            :is-loading="isLoading"
            :title="getInlineSnippet(card.title)"
        >
            <slot name="title">
                <sw-ai-copilot-badge v-if="card.aiBadge" />
            </slot>
            <slot
                name="beforeElements"
                v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
            ></slot>
            <template
                v-if="salesChannelSwitchable && config.length === 1"
                #toolbar
            >
                <sw-sales-channel-switch
                    :label="$tc('sw-settings.system-config.labelSalesChannelSelect')"
                    @change-sales-channel-id="onSalesChannelChanged"
                />
            </template>
            <template v-if="hasCssFields">
                <mt-banner variant="attention">
                    {{ $tc('sw-settings.system-config.compileNotice') }}
                </mt-banner>
            </template>
            <template v-if="!isLoading">
                {# Feature-Validierungsstatus #}
                <div v-if="featureValidation.isRunning" class="sw-system-config__feature-validation-status">
                    <mt-banner variant="info" class="sw-system-config__feature-validation-banner">
                        <div class="sw-system-config__feature-validation-content">
                            <sw-loader size="16px" class="sw-system-config__feature-validation-loader"></sw-loader>
                            <span class="sw-system-config__feature-validation-text">
                                {{ $tc('sw-settings-license-check.featureValidation.running', { feature: featureValidation.currentFeature }) }}
                            </span>
                            <span v-if="featureValidation.currentStep" class="sw-system-config__feature-validation-step">
                                → {{ featureValidation.currentStep }}
                            </span>
                        </div>
                    </mt-banner>
                </div>
                
                {# Aktive Blocks zuerst #}
                <template v-for="element in card.elements" :key="element.name">
                    <template v-if="isActiveBlock(element.name)">
                        <slot
                            name="card-element"
                            v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                        >
                            <sw-inherit-wrapper
                                v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                v-bind="getInheritWrapperBind(element)"
                                :has-parent="isNotDefaultSalesChannel"
                                :inherited-value="getInheritedValue(element)"
                                :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name) + ' sw-system-config--field-active'"
                            >
                                <template #content="props">
                                    <sw-form-field-renderer
                                        v-bind="getElementBind(element, props)"
                                        :key="props.isInheritField + props.isInherited"
                                        :disabled="props.isInherited"
                                        :value="props.currentValue"
                                        :error="getFieldError(element.name)"
                                        @update:value="props.updateCurrentValue"
                                    />
                                </template>
                            </sw-inherit-wrapper>
                        </slot>
                    </template>
                </template>
                
                {# Separator #}
                <div v-if="hasActiveBlocks && hasInactiveBlocks" class="sw-system-config__block-separator"></div>
                
                {# Inaktive Blocks (Coming Soon) #}
                <template v-for="element in card.elements" :key="element.name">
                    <template v-if="!isActiveBlock(element.name)">
                        <slot
                            name="card-element"
                            v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                        >
                            <sw-inherit-wrapper
                                v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                v-bind="getInheritWrapperBind(element)"
                                :has-parent="isNotDefaultSalesChannel"
                                :inherited-value="getInheritedValue(element)"
                                :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name) + ' sw-system-config--field-inactive'"
                            >
                                <template #content="props">
                                    <sw-form-field-renderer
                                        v-bind="getElementBind(element, props)"
                                        :key="props.isInheritField + props.isInherited"
                                        :disabled="props.isInherited"
                                        :value="props.currentValue"
                                        :error="getFieldError(element.name)"
                                        @update:value="props.updateCurrentValue"
                                    />
                                </template>
                            </sw-inherit-wrapper>
                        </slot>
                    </template>
                </template>
                <slot name="card-element-last"></slot>
            </template>
            <slot
                name="afterElements"
                v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
            ></slot>
        </mt-card>
        
        {# Index 1: Header + Mega Menu Settings - Collapsible (nur wenn Mega Menu enabled) #}
        <sw-collapse 
            v-else-if="isHeroBlocksConfig() && index === 1 && isMegaMenuEnabled" 
            :expand-on-loading="false"
        >
            <template #header="{ expanded }">
                <div class="sw-system-config__mega-menu-card-header">
                    <h3 class="mt-text--size-m mt-text--weight-semibold">
                        {{ getInlineSnippet(card.title) }}
                    </h3>
                    <div class="sw-system-config__mega-menu-card-header-right">
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="16"
                            class="sw-system-config__mega-menu-card-chevron"
                        />
                    </div>
                </div>
            </template>
            <template #content>
                <mt-card
                    position-identifier="sw-system-config-content"
                    :class="`sw-system-config__card--${index}`"
                    :is-loading="isLoading"
                >
                    <slot
                        name="beforeElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
                    ></slot>
                    <template v-if="!isLoading">
                        <template v-for="element in card.elements">
                            <slot
                                name="card-element"
                                v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                            >
                                <sw-inherit-wrapper
                                    v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                    v-bind="getInheritWrapperBind(element)"
                                    :has-parent="isNotDefaultSalesChannel"
                                    :inherited-value="getInheritedValue(element)"
                                    :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)"
                                >
                                    <template #content="props">
                                        <sw-form-field-renderer
                                            v-bind="getElementBind(element, props)"
                                            :key="props.isInheritField + props.isInherited"
                                            :disabled="props.isInherited"
                                            :value="props.currentValue"
                                            :error="getFieldError(element.name)"
                                            @update:value="props.updateCurrentValue"
                                        />
                                    </template>
                                </sw-inherit-wrapper>
                            </slot>
                        </template>
                        <slot name="card-element-last"></slot>
                    </template>
                    <slot
                        name="afterElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
                    ></slot>
                </mt-card>
            </template>
        </sw-collapse>
        
        {# Index 2: FAQ Block Settings - Collapsible (nur wenn FAQ Block enabled) #}
        <sw-collapse 
            v-else-if="isHeroBlocksConfig() && index === 2 && isFaqBlockEnabled" 
            :expand-on-loading="false"
        >
            <template #header="{ expanded }">
                <div class="sw-system-config__mega-menu-card-header">
                    <h3 class="mt-text--size-m mt-text--weight-semibold">
                        {{ getInlineSnippet(card.title) }}
                    </h3>
                    <div class="sw-system-config__mega-menu-card-header-right">
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="16"
                            class="sw-system-config__mega-menu-card-chevron"
                        />
                    </div>
                </div>
            </template>
            <template #content>
                <mt-card
                    position-identifier="sw-system-config-content"
                    :class="`sw-system-config__card--${index}`"
                    :is-loading="isLoading"
                >
                    <slot
                        name="beforeElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
                    ></slot>
                    <template v-if="!isLoading">
                        <template v-for="element in card.elements">
                            <slot
                                name="card-element"
                                v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                            >
                                <sw-inherit-wrapper
                                    v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                    v-bind="getInheritWrapperBind(element)"
                                    :has-parent="isNotDefaultSalesChannel"
                                    :inherited-value="getInheritedValue(element)"
                                    :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)"
                                >
                                    <template #content="props">
                                        <sw-form-field-renderer
                                            v-bind="getElementBind(element, props)"
                                            :key="props.isInheritField + props.isInherited"
                                            :disabled="props.isInherited"
                                            :value="props.currentValue"
                                            :error="getFieldError(element.name)"
                                            @update:value="props.updateCurrentValue"
                                        />
                                    </template>
                                </sw-inherit-wrapper>
                            </slot>
                        </template>
                        <slot name="card-element-last"></slot>
                    </template>
                    <slot
                        name="afterElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
                    ></slot>
                </mt-card>
            </template>
        </sw-collapse>
        
        {# Index 3: Update Information - Collapsible (IMMER ANZEIGEN) #}
        <sw-collapse 
            v-else-if="isHeroBlocksConfig() && index === 3" 
            :expand-on-loading="false"
        >
            <template #header="{ expanded }">
                <div class="sw-system-config__update-card-header">
                    <h3 class="mt-text--size-m mt-text--weight-semibold">
                        {{ getInlineSnippet(card.title) }}
                    </h3>
                    <div class="sw-system-config__update-card-header-right">
                        <sw-status 
                            v-if="updateAvailable"
                            color="blue"
                        >
                            {{ $tc('sw-settings-license-check.update.available') }}
                        </sw-status>
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="16"
                            class="sw-system-config__update-card-chevron"
                        />
                    </div>
                </div>
            </template>
            <template #content>
                <mt-card
                    position-identifier="sw-system-config-content"
                    :class="`sw-system-config__card--${index}`"
                    :is-loading="isLoading"
                >
                    <slot
                        name="beforeElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
                    ></slot>
                    <template v-if="!isLoading">
                        <template v-for="element in card.elements">
                            <slot
                                name="card-element"
                                v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                            >
                                <sw-inherit-wrapper
                                    v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                    v-bind="getInheritWrapperBind(element)"
                                    :has-parent="isNotDefaultSalesChannel"
                                    :inherited-value="getInheritedValue(element)"
                                    :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)"
                                >
                                    <template #content="props">
                                        <sw-form-field-renderer
                                            v-bind="getElementBind(element, props)"
                                            :key="props.isInheritField + props.isInherited"
                                            :disabled="props.isInherited"
                                            :value="props.currentValue"
                                            :error="getFieldError(element.name)"
                                            @update:value="props.updateCurrentValue"
                                        />
                                    </template>
                                </sw-inherit-wrapper>
                            </slot>
                        </template>
                        
                        {# Update Check Button #}
                        <div class="sw-system-config__hero-blocks-update-check">
                            <mt-banner 
                                v-if="isLicenseExpired" 
                                variant="critical"
                                class="sw-system-config__license-expired-warning"
                            >
                                {{ $tc('sw-settings-license-check.update.licenseExpiredMessage') }}
                            </mt-banner>
                            <div class="sw-system-config__hero-blocks-update-buttons">
                                <mt-button
                                    variant="primary"
                                    size="default"
                                    :is-loading="isUpdateChecking"
                                    :disabled="isUpdateChecking || isLicenseExpired"
                                    @click="checkHeroBlocksUpdates"
                                    class="hero-blocks-update-check-button"
                                >
                                    <template v-if="!isUpdateChecking">
                                        <mt-icon name="regular-sync" size="16"></mt-icon>
                                        <span>{{ $tc('sw-settings-license-check.update.checkForUpdates') }}</span>
                                    </template>
                                    <template v-else>
                                        <sw-loader size="16px"></sw-loader>
                                        <span>{{ $tc('sw-settings-license-check.update.checking') }}</span>
                                    </template>
                                </mt-button>
                                
                                <div 
                                    v-if="updateAvailable && updateDownloadUrl && !isLicenseExpired"
                                    class="hero-blocks-update-download-wrapper"
                                >
                                    <mt-button
                                        variant="primary"
                                        size="default"
                                        :is-loading="isUpdateDownloading"
                                        :disabled="isUpdateDownloading || isUpdateChecking"
                                        @click="downloadHeroBlocksUpdate"
                                        class="hero-blocks-update-download-button"
                                    >
                                        <template v-if="!isUpdateDownloading">
                                            <mt-icon name="regular-download" size="16"></mt-icon>
                                            <span>{{ $tc('sw-settings-license-check.update.downloadUpdate') }}</span>
                                        </template>
                                        <template v-else>
                                            <sw-loader size="16px"></sw-loader>
                                            <span>{{ $tc('sw-settings-license-check.update.downloading') }}</span>
                                        </template>
                                    </mt-button>
                                    
                                    <div 
                                        v-if="isUpdateDownloading"
                                        class="hero-blocks-progress-bar"
                                        role="progressbar"
                                        aria-label="Update wird heruntergeladen"
                                        aria-busy="true"
                                    >
                                        <div class="hero-blocks-progress-bar__track">
                                            <div class="hero-blocks-progress-bar__fill hero-blocks-progress-bar__fill--indeterminate"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <slot name="card-element-last"></slot>
                    </template>
                    <slot
                        name="afterElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
                    ></slot>
                </mt-card>
            </template>
        </sw-collapse>
        
        {# Index 4: License Information - Collapsible (IMMER ANZEIGEN) #}
        <sw-collapse 
            v-else-if="isHeroBlocksConfig() && index === 4" 
            :expand-on-loading="false"
        >
            <template #header="{ expanded }">
                <div class="sw-system-config__license-card-header">
                    <h3 class="mt-text--size-m mt-text--weight-semibold">
                        {{ getInlineSnippet(card.title) }}
                    </h3>
                    <div class="sw-system-config__license-card-header-right">
                        <sw-status 
                            v-if="licenseStatusClass === 'is--license-active'"
                            color="green"
                        >
                            {{ $tc('sw-settings-license-check.status.active') }}
                        </sw-status>
                        <sw-status 
                            v-else-if="licenseStatusClass === 'is--license-expired'"
                            color="red"
                        >
                            {{ $tc('sw-settings-license-check.status.expired') }}
                        </sw-status>
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="16"
                            class="sw-system-config__license-card-chevron"
                        />
                    </div>
                </div>
            </template>
            <template #content>
                <mt-card
                    position-identifier="sw-system-config-content"
                    :class="`sw-system-config__card--${index}`"
                    :is-loading="isLoading"
                >
                    <slot
                        name="beforeElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
                    ></slot>
                    <template v-if="!isLoading">
                        <template v-for="element in card.elements">
                            <slot
                                name="card-element"
                                v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                            >
                                <sw-inherit-wrapper
                                    v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                    v-bind="getInheritWrapperBind(element)"
                                    :has-parent="isNotDefaultSalesChannel"
                                    :inherited-value="getInheritedValue(element)"
                                    :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name) + (element.name === 'HeroBlocks.config.licenseStatus' ? ' ' + licenseStatusClass : '')"
                                >
                                    <template #content="props">
                                        <sw-form-field-renderer
                                            v-bind="getElementBind(element, props)"
                                            :key="props.isInheritField + props.isInherited"
                                            :disabled="props.isInherited"
                                            :value="props.currentValue"
                                            :error="getFieldError(element.name)"
                                            @update:value="props.updateCurrentValue"
                                        />
                                    </template>
                                </sw-inherit-wrapper>
                            </slot>
                        </template>
                        
                        {# License Check Buttons - Nebeneinander in einer Zeile #}
                        <div class="sw-system-config__hero-blocks-license-check-buttons">
                            {# License Check Button #}
                            <mt-button
                                variant="primary"
                                size="default"
                                :is-loading="isLicenseChecking"
                                :disabled="isLicenseChecking"
                                @click="checkHeroBlocksLicense"
                                class="hero-blocks-license-check-button"
                            >
                                <template v-if="!isLicenseChecking">
                                    <mt-icon name="regular-check-circle" size="16"></mt-icon>
                                    <span>{{ $tc('sw-settings-license-check.button.checkLicense') }}</span>
                                </template>
                                <template v-else>
                                    <sw-loader size="16px"></sw-loader>
                                    <span>{{ $tc('sw-settings-license-check.button.checking') }}</span>
                                </template>
                            </mt-button>
                            
                            {# Test Email Button (DEV ONLY) - Nur in Entwicklungsumgebung anzeigen #}
                            <mt-button
                                v-if="isDevelopmentMode"
                                variant="ghost"
                                size="default"
                                :is-loading="isEmailTestSending"
                                :disabled="isEmailTestSending"
                                @click="sendTestExpiryEmail"
                                class="hero-blocks-email-test-button"
                            >
                                <template v-if="!isEmailTestSending">
                                    <mt-icon name="regular-envelope" size="16"></mt-icon>
                                    <span>DEV Test Email</span>
                                </template>
                                <template v-else>
                                    <sw-loader size="16px"></sw-loader>
                                    <span>Sending...</span>
                                </template>
                            </mt-button>
                        </div>
                        
                        {# WICHTIG: Renewal-Hinweis bei abgelaufener Lizenz (verkaufspsychologisch optimiert) #}
                        <div v-if="isLicenseExpired" class="sw-system-config__hero-blocks-license-renewal">
                            <mt-alert variant="warning" class="sw-system-config__hero-blocks-license-renewal-alert">
                                <template #title>
                                    <div class="sw-system-config__hero-blocks-license-renewal-title">
                                        {{ $tc('sw-settings-license-check.renewal.title') }}
                                    </div>
                                </template>
                                <div class="sw-system-config__hero-blocks-license-renewal-content">
                                    <p class="sw-system-config__hero-blocks-license-renewal-message" v-html="$tc('sw-settings-license-check.renewal.message')"></p>
                                    
                                    {# Feature-Liste #}
                                    <div class="sw-system-config__hero-blocks-license-renewal-features">
                                        <div class="sw-system-config__hero-blocks-license-renewal-features-title">
                                            <mt-icon name="solid-star" size="16" color="#fbbf24"></mt-icon>
                                            {{ $tc('sw-settings-license-check.renewal.features.title') }}
                                        </div>
                                        <ul class="sw-system-config__hero-blocks-license-renewal-features-list">
                                            <li><mt-icon name="solid-check-circle" size="14" color="#10b981"></mt-icon> {{ $tc('sw-settings-license-check.renewal.features.updates') }}</li>
                                            <li><mt-icon name="solid-check-circle" size="14" color="#10b981"></mt-icon> {{ $tc('sw-settings-license-check.renewal.features.support') }}</li>
                                            <li><mt-icon name="solid-check-circle" size="14" color="#10b981"></mt-icon> {{ $tc('sw-settings-license-check.renewal.features.newFeatures') }}</li>
                                            <li><mt-icon name="solid-check-circle" size="14" color="#10b981"></mt-icon> {{ $tc('sw-settings-license-check.renewal.features.security') }}</li>
                                        </ul>
                                    </div>
                                    
                                    {# Renewal-Button #}
                                    <a 
                                        href="https://matt-interfaces.ch/shopware-hero-block?plugin=hero-blocks&action=renew"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="sw-system-config__hero-blocks-license-renewal-button"
                                    >
                                        <mt-button variant="primary" size="default">
                                            <mt-icon name="solid-external-link" size="16"></mt-icon>
                                            {{ $tc('sw-settings-license-check.renewal.button') }}
                                        </mt-button>
                                    </a>
                                </div>
                            </mt-alert>
                        </div>
                        
                        <slot name="card-element-last"></slot>
                    </template>
                    <slot
                        name="afterElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
                    ></slot>
                </mt-card>
            </template>
        </sw-collapse>
        
        {# Index 5: Instagram Feed Settings - Collapsible (nur wenn Instagram Feed enabled) #}
        <sw-collapse 
            v-else-if="isHeroBlocksConfig() && index === 5 && isInstagramFeedEnabled" 
            :expand-on-loading="false"
        >
            <template #header="{ expanded }">
                <div class="sw-system-config__mega-menu-card-header">
                    <h3 class="mt-text--size-m mt-text--weight-semibold">
                        {{ getInlineSnippet(card.title) }}
                    </h3>
                    <div class="sw-system-config__mega-menu-card-header-right">
                        <mt-icon 
                            :name="expanded ? 'regular-chevron-up-xs' : 'regular-chevron-down-xs'" 
                            size="16"
                            class="sw-system-config__mega-menu-card-chevron"
                        />
                    </div>
                </div>
            </template>
            <template #content>
                <mt-card
                    position-identifier="sw-system-config-content"
                    :class="`sw-system-config__card--${index}`"
                    :is-loading="isLoading"
                >
                    <slot
                        name="beforeElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
                    ></slot>
                    <template v-if="!isLoading">
                        <mt-banner 
                            v-if="isLicenseExpired" 
                            variant="critical"
                            class="sw-system-config__license-expired-warning"
                        >
                            {{ $tc('sw-settings-license-check.instagramFeed.licenseExpiredMessage') }}
                        </mt-banner>
                        
                        <mt-banner variant="info" class="sw-system-config__instagram-feed-setup-guide">
                            <div class="sw-system-config__instagram-feed-setup-guide-content">
                                <h4 class="sw-system-config__instagram-feed-setup-guide-title">
                                    {{ $tc('sw-settings-license-check.instagram.setupGuide.title') }}
                                </h4>
                                <p class="sw-system-config__instagram-feed-setup-guide-text">
                                    {{ $tc('sw-settings-license-check.instagram.setupGuide.description') }}
                                </p>
                                <ul class="sw-system-config__instagram-feed-setup-guide-steps">
                                    <li>
                                        <strong>{{ $tc('sw-settings-license-check.instagram.setupGuide.step1.title') }}</strong>
                                        <p>{{ $tc('sw-settings-license-check.instagram.setupGuide.step1.description') }}</p>
                                        <a href="https://developers.facebook.com/apps/" target="_blank" rel="noopener noreferrer" class="sw-system-config__instagram-feed-setup-guide-link">
                                            {{ $tc('sw-settings-license-check.instagram.setupGuide.step1.link') }}
                                        </a>
                                    </li>
                                    <li>
                                        <strong>{{ $tc('sw-settings-license-check.instagram.setupGuide.step2.title') }}</strong>
                                        <p>{{ $tc('sw-settings-license-check.instagram.setupGuide.step2.description') }}</p>
                                        <a href="https://developers.facebook.com/docs/instagram-basic-display-api/getting-started" target="_blank" rel="noopener noreferrer" class="sw-system-config__instagram-feed-setup-guide-link">
                                            {{ $tc('sw-settings-license-check.instagram.setupGuide.step2.link') }}
                                        </a>
                                    </li>
                                    <li>
                                        <strong>{{ $tc('sw-settings-license-check.instagram.setupGuide.step3.title') }}</strong>
                                        <p>{{ $tc('sw-settings-license-check.instagram.setupGuide.step3.description') }}</p>
                                        <a href="https://developers.facebook.com/docs/instagram-basic-display-api/overview" target="_blank" rel="noopener noreferrer" class="sw-system-config__instagram-feed-setup-guide-link">
                                            {{ $tc('sw-settings-license-check.instagram.setupGuide.step3.link') }}
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </mt-banner>
                        
                        <template v-for="element in card.elements">
                            <slot
                                name="card-element"
                                v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                            >
                                <sw-inherit-wrapper
                                    v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                                    v-bind="getInheritWrapperBind(element)"
                                    :has-parent="isNotDefaultSalesChannel"
                                    :inherited-value="getInheritedValue(element)"
                                    :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)"
                                >
                                    <template #content="props">
                                        <sw-form-field-renderer
                                            v-bind="getElementBind(element, props)"
                                            :key="props.isInheritField + props.isInherited"
                                            :disabled="props.isInherited || isLicenseExpired"
                                            :value="props.currentValue"
                                            :error="getFieldError(element.name)"
                                            @update:value="props.updateCurrentValue"
                                        />
                                    </template>
                                </sw-inherit-wrapper>
                            </slot>
                        </template>
                        
                        {# Instagram Token Check Button #}
                        <div class="sw-system-config__hero-blocks-instagram-token-check">
                            <div class="sw-system-config__hero-blocks-instagram-token-check-buttons">
                                <mt-button
                                    variant="primary"
                                    size="default"
                                    :is-loading="isInstagramTokenChecking"
                                    :disabled="isInstagramTokenChecking || isLicenseExpired"
                                    @click="checkHeroBlocksInstagramToken"
                                    class="hero-blocks-instagram-token-check-button"
                                >
                                    <template v-if="!isInstagramTokenChecking">
                                        <mt-icon name="regular-check-circle" size="16"></mt-icon>
                                        <span>{{ $tc('sw-settings-license-check.instagram.checkToken') }}</span>
                                    </template>
                                    <template v-else>
                                        <sw-loader size="16px"></sw-loader>
                                        <span>{{ $tc('sw-settings-license-check.instagram.checking') }}</span>
                                    </template>
                                </mt-button>
                            </div>
                        </div>
                        
                        <slot name="card-element-last"></slot>
                    </template>
                    <slot
                        name="afterElements"
                        v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
                    ></slot>
                </mt-card>
            </template>
        </sw-collapse>
        
        {# WICHTIG: Standard Shopware Rendering für andere Plugins oder wenn kein Hero Blocks Match #}
        <mt-card
            v-else-if="!isHeroBlocksConfig()"
            position-identifier="sw-system-config-content"
            :class="`sw-system-config__card--${index}`"
            :is-loading="isLoading"
            :title="getInlineSnippet(card.title)"
        >
            <slot name="title">
                <sw-ai-copilot-badge v-if="card.aiBadge" />
            </slot>
            <slot
                name="beforeElements"
                v-bind="{ card, config: actualConfigData[currentSalesChannelId] }"
            ></slot>
            <template
                v-if="salesChannelSwitchable && config.length === 1"
                #toolbar
            >
                <sw-sales-channel-switch
                    :label="$tc('sw-settings.system-config.labelSalesChannelSelect')"
                    @change-sales-channel-id="onSalesChannelChanged"
                />
            </template>
            <template v-if="hasCssFields">
                <mt-banner variant="attention">
                    {{ $tc('sw-settings.system-config.compileNotice') }}
                </mt-banner>
            </template>
            <template v-if="!isLoading">
                <template v-for="element in card.elements">
                    <slot
                        name="card-element"
                        v-bind="{ element: getElementBind(element), config: actualConfigData[currentSalesChannelId], card }"
                    >
                        <sw-inherit-wrapper
                            v-model:value="actualConfigData[currentSalesChannelId][element.name]"
                            v-bind="getInheritWrapperBind(element)"
                            :has-parent="isNotDefaultSalesChannel"
                            :inherited-value="getInheritedValue(element)"
                            :class="'sw-system-config--field-' + kebabCase(getElementBind(element).name)"
                        >
                            <template #content="props">
                                <sw-form-field-renderer
                                    v-bind="getElementBind(element, props)"
                                    :key="props.isInheritField + props.isInherited"
                                    :disabled="props.isInherited"
                                    :value="props.currentValue"
                                    :error="getFieldError(element.name)"
                                    @update:value="props.updateCurrentValue"
                                />
                            </template>
                        </sw-inherit-wrapper>
                    </slot>
                </template>
                <slot name="card-element-last"></slot>
            </template>
            <slot
                name="afterElements"
                v-bind="{ card, config: actualConfigData[currentSalesChannelId], index, isNotDefaultSalesChannel, inheritance: actualConfigData.null }"
            ></slot>
        </mt-card>
    </template>
    {% endblock %}
</div>
{% endblock %}
