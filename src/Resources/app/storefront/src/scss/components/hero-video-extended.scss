/**
 * Hero Video Extended Block - Storefront Styles
 * 
 * QUELLE: HeroBlocks Plugin (eigenständig nutzbar)
 * Theme-Variablen (--sw-color-*, --bs-*) werden vom aktiven Theme vererbt.
 * 
 * Features:
 * - Full-width video background
 * - Angled text overlay (KONSTANT 33° - außen gerade, innen abgeschrägt)
 * - Scroll animation (von außen nach innen)
 * - Responsive design (Mobile First)
 * - Accessibility (reduced motion, print)
 * 
 * KONSTANTER 33°-WINKEL (Best Practice nach NewCity)
 * ==================================================
 * Referenz: https://www.insidenewcity.com/consistent-diagonal-clipping-with-css/
 * 
 * Für einen konstanten Winkel θ unabhängig von der Element-Höhe gilt:
 *   offset = height × tan(θ)
 * 
 * tan(33°) ≈ 0.6494
 * 
 * IMPLEMENTIERUNG:
 * 1. CSS Custom Property --overlay-tangent: 0.6494 (tan(33°))
 * 2. JavaScript setzt --overlay-height basierend auf offsetHeight
 * 3. clip-path verwendet: calc(var(--overlay-tangent) * var(--overlay-height))
 * 
 * WICHTIG: Admin-Settings für background-color werden 1:1 übernommen!
 * 
 * @since 1.0.0
 */

// ============================================================================
// SECTION OVERRIDE - Verhindert Abschneiden des überstehenden Overlays
// ============================================================================
.cms-section:has(.cms-block-hero-video-extended) {
    overflow: visible !important;
}

// Fallback für Browser ohne :has()
.cms-section--hero-video-extended-wrapper {
    overflow: visible !important;
}

// ============================================================================
// MAIN BLOCK
// ============================================================================
.cms-block-hero-video-extended {
    position: relative;
    width: 100%;
    min-height: 400px;
    overflow: visible;
    background-color: #1a1a2e;

    // ========================================
    // VIDEO WRAPPER
    // ========================================
    &__video-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 0;
    overflow: hidden;
}

    &__video {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
        object-fit: cover;
}

    &__placeholder {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
        align-items: center;
    justify-content: center;
        background-color: #1a1a1a;
        color: rgba(255, 255, 255, 0.5);
        font-size: 1.25rem;;
    }
    
    // ========================================
    // OVERLAY PANEL - Angled Text Box
    // ========================================
    // KONSTANT 33° Winkel: außen GERADE, innen ABGESCHRÄGT
    // 
    // Best Practice nach NewCity:
    // https://www.insidenewcity.com/consistent-diagonal-clipping-with-css/
    // 
    // MATHEMATIK:
    // offset = height × tan(θ)
    // 
    // RESPONSIVE WINKEL:
    // - Mobile: tan(15°) ≈ 0.2679 (flacherer Winkel für hohe Elemente)
    // - Tablet: tan(25°) ≈ 0.4663
    // - Desktop: tan(33°) ≈ 0.6494
    // 
    // IMPLEMENTIERUNG:
    // --overlay-tangent: [responsive, via Media Query]
    // --overlay-height: [via JavaScript gesetzt]
    // --overlay-corner-offset: calc(var(--overlay-tangent) * var(--overlay-height))
    // --overlay-max-offset: [maximaler Offset für Mobile]
    // ========================================
    &__overlay {
        position: absolute;
        z-index: 10;
        width: 85%; // Mobile: breiteres Overlay
        min-width: 260px;
        padding: 1.5rem;
        
        // ========================================
        // RESPONSIVE WINKEL-BERECHNUNG
        // ========================================
        // Mobile: tan(15°) ≈ 0.2679 (flacherer Winkel)
        --overlay-tangent: 0.2679;
        // Höhe wird via JavaScript gesetzt (ResizeObserver)
        --overlay-height: 0px;
        // Maximaler Offset für Mobile (verhindert zu große Abschnitte)
        --overlay-max-offset: 80px;
        // Berechneter Offset mit Maximum
        --overlay-corner-offset: min(
            calc(var(--overlay-tangent) * var(--overlay-height)),
            var(--overlay-max-offset)
        );
        
        // WICHTIG: KEIN background-color hier!
        // Admin-Settings werden via inline style 1:1 übernommen.
        
        // ========================================
        // KRITISCH: Hardware-Beschleunigung für clip-path
        // ========================================
        // Problem: Bei transform-Animationen kann clip-path "verschwinden"
        // Lösung: Erzwinge GPU-Rendering mit translateZ(0) und isolation
        // Referenz: https://stackoverflow.com/questions/48163824/clip-path-not-working-with-transform
        isolation: isolate;
        // WICHTIG: Basis-Transform für Hardware-Beschleunigung
        // Wird von den Animations-States überschrieben
        transform: translateZ(0);
        
        // Smooth Animation - NUR transform und opacity animieren
        // WICHTIG: clip-path NICHT animieren (verursacht Glitches)
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                    opacity 0.6s ease-out;

        // ========================================
        // LEFT POSITIONS - Schräge nur RECHTS
        // Außen (links) gerade!
        // ========================================
        &--top-left,
        &--middle-left,
        &--bottom-left {
            left: 0;
            text-align: left;
            
            // KONSTANTER 33° Winkel: offset = height × tan(33°)
            clip-path: polygon(0 0, 100% 0, calc(100% - var(--overlay-corner-offset)) 100%, 0 100%);
            padding-right: calc(1.5rem + var(--overlay-corner-offset));
        }

        &--top-left {
            top: -1.5rem;
            // WICHTIG: translateZ(0) für Hardware-Beschleunigung
            transform: translateZ(0);
        }

        &--middle-left {
            top: 50%;
            // WICHTIG: translateZ(0) zusammen mit translateY für konsistentes Rendering
            transform: translateY(-50%) translateZ(0);
        }

        &--bottom-left {
            bottom: -1.5rem;
            transform: translateZ(0);
        }

        // ========================================
        // RIGHT POSITIONS - Schräge nur LINKS
        // Außen (rechts) gerade!
        // ========================================
        &--top-right,
        &--middle-right,
        &--bottom-right {
            right: 0;
            left: auto;
            text-align: left;
    
            // KONSTANTER 33° Winkel: offset = height × tan(33°)
            clip-path: polygon(var(--overlay-corner-offset) 0, 100% 0, 100% 100%, 0 100%);
            padding-left: calc(1.5rem + var(--overlay-corner-offset));
        }

        &--top-right {
            top: -1.5rem;
            transform: translateZ(0);
        }

        &--middle-right {
            top: 50%;
            transform: translateY(-50%) translateZ(0);
        }

        &--bottom-right {
            bottom: -1.5rem;
            transform: translateZ(0);
        }

        // ========================================
        // TABLET: Responsive Anpassungen
        // ========================================
        @media (min-width: 768px) {
            width: 55%;
            padding: 2rem 2.5rem;
            
            // Tablet: tan(25°) ≈ 0.4663 (mittlerer Winkel)
            --overlay-tangent: 0.4663;
            --overlay-max-offset: 120px;
            
            // Padding passt sich automatisch an via --overlay-corner-offset
            &--top-left,
            &--middle-left,
            &--bottom-left {
                padding-right: calc(2.5rem + var(--overlay-corner-offset));
            }
            
            &--top-right,
            &--middle-right,
            &--bottom-right {
                padding-left: calc(2.5rem + var(--overlay-corner-offset));
            }
    
            &--top-left,
            &--top-right {
                top: -2rem;
            }
            
            &--bottom-left,
            &--bottom-right {
                bottom: -2rem;
            }
            
            // WICHTIG: middle-Positionen brauchen translateY(-50%) + translateZ(0)
            &--middle-left,
            &--middle-right {
                transform: translateY(-50%) translateZ(0);
            }
        }

        // ========================================
        // DESKTOP: Größere Overlays, voller 33°-Winkel
        // ========================================
        @media (min-width: 1200px) {
            width: 50%;
            
            // Desktop: tan(33°) ≈ 0.6494 (voller Winkel)
            --overlay-tangent: 0.6494;
            --overlay-max-offset: 200px;
        }

        // ========================================
        // SCROLL ANIMATION - Initial State
        // ========================================
        // WICHTIG: clip-path muss IMMER angewendet werden, unabhängig vom Animations-Status!
        // Problem war: Bei transform-Animation konnte clip-path "verschwinden"
        // Lösung: clip-path wird NICHT in der Animation verändert, nur transform und opacity
        &[data-overlay-animate]:not(.is-animated) {
            opacity: 0;
            // WICHTIG: will-change für bessere Performance und verhindert Rendering-Glitches
            will-change: transform, opacity;
            // WICHTIG: backface-visibility verhindert Flicker bei 3D-Transforms
            backface-visibility: hidden;
            // WICHTIG: transform-style für konsistente Rendering
            transform-style: preserve-3d;
        }
        
        // Left positions: slide from left
        &--top-left[data-overlay-animate]:not(.is-animated),
        &--bottom-left[data-overlay-animate]:not(.is-animated) {
            transform: translateX(-100%) translateZ(0);
        
            @media (min-width: 768px) {
                transform: translateX(-120%) translateZ(0);
            }
        }
        
        &--middle-left[data-overlay-animate]:not(.is-animated) {
            transform: translateX(-100%) translateY(-50%) translateZ(0);
            
            @media (min-width: 768px) {
                transform: translateX(-120%) translateY(-50%) translateZ(0);
            }
        }
    
        // Right positions: slide from right
        &--top-right[data-overlay-animate]:not(.is-animated),
        &--bottom-right[data-overlay-animate]:not(.is-animated) {
            transform: translateX(100%) translateZ(0);
            
            @media (min-width: 768px) {
                transform: translateX(120%) translateZ(0);
            }
        }
        
        &--middle-right[data-overlay-animate]:not(.is-animated) {
            transform: translateX(100%) translateY(-50%) translateZ(0);
            
            @media (min-width: 768px) {
                transform: translateX(120%) translateY(-50%) translateZ(0);
            }
        }

        // ========================================
        // SCROLL ANIMATION - Animated State
        // ========================================
        &[data-overlay-animate].is-animated {
            opacity: 1;
            // WICHTIG: will-change entfernen nach Animation für bessere Performance
            will-change: auto;
        }
        
        &--top-left[data-overlay-animate].is-animated,
        &--bottom-left[data-overlay-animate].is-animated,
        &--top-right[data-overlay-animate].is-animated,
        &--bottom-right[data-overlay-animate].is-animated {
            // WICHTIG: translateZ(0) für Hardware-Beschleunigung und konsistentes Rendering
            transform: translateX(0) translateZ(0);
        }
        
        &--middle-left[data-overlay-animate].is-animated,
        &--middle-right[data-overlay-animate].is-animated {
            transform: translateX(0) translateY(-50%) translateZ(0);
        }
        
        // Fallback: Ohne data-overlay-animate immer sichtbar
        &:not([data-overlay-animate]) {
            opacity: 1;
            // WICHTIG: Auch hier translateZ(0) für konsistentes clip-path Rendering
            transform: translateZ(0);
        }
    }
    
    // ========================================
    // OVERLAY CONTENT
    // ========================================
    &__overlay-content {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 0.25rem; // Konsistenter Abstand zwischen Headline und Text
        
        // ========================================
        // HEADLINE STYLES (via HTML class)
        // Für sprachabhängigen Content aus Element-Slot
        // WICHTIG: Konsistent mit hero-image-overlay Block!
        // ========================================
        h2,
        .hero-overlay-headline {
            margin: 0 0 0.25rem 0;
            font-family: 'Oswald', var(--sw-font-family-headline, sans-serif);
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.3;
            text-transform: uppercase;
            // WICHTIG: Weiß als Standard - inline styles können überschreiben
            color: #ffffff;
            
            @media (min-width: 768px) {
                font-size: 1.5rem;
            }
            
            @media (min-width: 1200px) {
                font-size: 1.65rem;
            }
        }
        
        // ========================================
        // TEXT STYLES (via HTML class)
        // WICHTIG: Konsistent mit hero-image-overlay Block!
        // ========================================
        p,
        .hero-overlay-text {
            margin: 0;
            font-size: 0.9rem;
            font-weight: 400;
            line-height: 1.4;
            // WICHTIG: Weiß als Standard - inline styles können überschreiben
            color: #ffffff;
            
            @media (min-width: 768px) {
                font-size: 1.25rem;
            }
        }
    }
    
    // Legacy: Alte BEM-Klassen (für Rückwärtskompatibilität)
    &__headline {
        margin: 0 0 0.25rem 0;
        font-family: 'Oswald', var(--sw-font-family-headline, sans-serif);
        font-size: 1.25rem;
        font-weight: 500;
        line-height: 1.3;
        text-transform: uppercase;
        color: inherit;
        
        @media (min-width: 768px) {
            font-size: 1.5rem;
        }
        
        @media (min-width: 1200px) {
            font-size: 1.65rem;
        }
    }

    &__text {
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.4;
        color: inherit;
        
        p {
            margin: 0 0 0.5rem;
            color: inherit;
            
            &:last-child {
                margin-bottom: 0;
            }
        }
        
        @media (min-width: 768px) {
            font-size: 1.25rem;
        }
    }
}

// ============================================================================
// ACCESSIBILITY: Reduced Motion
// ============================================================================
@media (prefers-reduced-motion: reduce) {
    .cms-block-hero-video-extended {
        &__overlay {
            transition: none;
            
            &[data-overlay-animate] {
                opacity: 1;
                // WICHTIG: translateZ(0) beibehalten für konsistentes clip-path Rendering
                transform: translateZ(0) !important;
                
                &.cms-block-hero-video-extended__overlay--middle-left,
                &.cms-block-hero-video-extended__overlay--middle-right {
                    transform: translateY(-50%) translateZ(0) !important;
                }
            }
        }

        &__video {
            animation-play-state: paused !important;
        }
    }
}

// ============================================================================
// PRINT STYLES
// ============================================================================
@media print {
    .cms-block-hero-video-extended {
        min-height: 300px;
        
        &__video,
        &__video-wrapper {
            display: none;
        }
        
        &__overlay {
            opacity: 1 !important;
            transform: none !important;
            position: relative;
            width: 100%;
            max-width: 100%;
            clip-path: none;
            padding: 1rem;
        }
    }
}
