/**
 * Hero Image Overlay Block - Storefront Styles
 * 
 * QUELLE: HeroBlocks Plugin (eigenständig nutzbar)
 * Theme-Variablen (--sw-color-*, --bs-*) werden vom aktiven Theme vererbt.
 * 
 * Features:
 * - Full-width image background
 * - Angled text overlay (KONSTANT 33° - außen gerade, innen abgeschrägt)
 * - Scroll animation (von außen nach innen)
 * - Responsive design (Mobile First)
 * - Accessibility (reduced motion, print)
 * 
 * KONSTANTER 33°-WINKEL (Best Practice nach NewCity)
 * ==================================================
 * Referenz: https://www.insidenewcity.com/consistent-diagonal-clipping-with-css/
 * 
 * Für einen konstanten Winkel θ unabhängig von der Element-Höhe gilt:
 *   offset = height × tan(θ)
 * 
 * tan(33°) ≈ 0.6494
 * 
 * IMPLEMENTIERUNG:
 * 1. CSS Custom Property --overlay-tangent: 0.6494 (tan(33°))
 * 2. JavaScript setzt --overlay-height basierend auf offsetHeight
 * 3. clip-path verwendet: calc(var(--overlay-tangent) * var(--overlay-height))
 * 
 * WICHTIG: Admin-Settings für background-color werden 1:1 übernommen!
 * Die SCSS-Datei setzt KEINEN eigenen background-color, nur Fallback via CSS var.
 * 
 * @since 1.0.0
 */

// ============================================================================
// SECTION OVERRIDE - Verhindert Abschneiden des überstehenden Overlays
// ============================================================================
.cms-section:has(.cms-block-hero-image-overlay) {
    overflow: visible !important;
}

// Fallback für Browser ohne :has()
.cms-section--hero-image-overlay-wrapper {
    overflow: visible !important;
}

// ============================================================================
// MAIN BLOCK
// ============================================================================
.cms-block-hero-image-overlay {
    position: relative;
    width: 100%;
    min-height: 400px;
    overflow: visible;
    padding: 0;

    // ========================================
    // IMAGE WRAPPER
    // ========================================
    &__image-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 0;
        overflow: hidden;
    }

    &__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    // ========================================
    // OVERLAY PANEL - Angled Text Box
    // ========================================
    // KONSTANT 33° Winkel: außen GERADE, innen ABGESCHRÄGT
    // 
    // Best Practice nach NewCity:
    // https://www.insidenewcity.com/consistent-diagonal-clipping-with-css/
    // 
    // MATHEMATIK:
    // offset = height × tan(θ)
    // 
    // RESPONSIVE WINKEL:
    // - Mobile: tan(15°) ≈ 0.2679 (flacherer Winkel für hohe Elemente)
    // - Tablet: tan(25°) ≈ 0.4663
    // - Desktop: tan(33°) ≈ 0.6494
    // 
    // IMPLEMENTIERUNG:
    // --overlay-tangent: [responsive, via Media Query]
    // --overlay-height: [via JavaScript gesetzt]
    // --overlay-corner-offset: calc(var(--overlay-tangent) * var(--overlay-height))
    // --overlay-max-offset: [maximaler Offset für Mobile]
    // ========================================
    &__overlay {
        position: absolute;
        z-index: 10;
        width: 85%; // Mobile: breiteres Overlay
        min-width: 260px;
        padding: 1.5rem;
        
        // ========================================
        // RESPONSIVE WINKEL-BERECHNUNG
        // ========================================
        // Mobile: tan(15°) ≈ 0.2679 (flacherer Winkel)
        --overlay-tangent: 0.2679;
        // Höhe wird via JavaScript gesetzt (ResizeObserver)
        --overlay-height: 0px;
        // Maximaler Offset für Mobile (verhindert zu große Abschnitte)
        --overlay-max-offset: 80px;
        // Berechneter Offset mit Maximum
        --overlay-corner-offset: min(
            calc(var(--overlay-tangent) * var(--overlay-height)),
            var(--overlay-max-offset)
        );
        
        // WICHTIG: KEIN background-color hier!
        // Admin-Settings werden via inline style 1:1 übernommen.
        
        // Smooth Animation
        transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                    opacity 0.6s ease-out;

        // ========================================
        // LEFT POSITIONS - Schräge nur RECHTS
        // Außen (links) gerade!
        // ========================================
        &--top-left,
        &--middle-left,
        &--bottom-left {
            left: 0;
            text-align: left;
            
            // KONSTANTER 33° Winkel: offset = height × tan(33°)
            clip-path: polygon(0 0, 100% 0, calc(100% - var(--overlay-corner-offset)) 100%, 0 100%);
            padding-right: calc(1.5rem + var(--overlay-corner-offset));
        }

        &--top-left {
            top: -1.5rem;
        }

        &--middle-left {
            top: 50%;
            transform: translateY(-50%);
        }

        &--bottom-left {
            bottom: -1.5rem;
        }

        // ========================================
        // RIGHT POSITIONS - Schräge nur LINKS
        // Außen (rechts) gerade!
        // ========================================
        &--top-right,
        &--middle-right,
        &--bottom-right {
            right: 0;
            left: auto;
            text-align: left;
            
            // KONSTANTER 33° Winkel: offset = height × tan(33°)
            clip-path: polygon(var(--overlay-corner-offset) 0, 100% 0, 100% 100%, 0 100%);
            padding-left: calc(1.5rem + var(--overlay-corner-offset));
        }

        &--top-right {
            top: -1.5rem;
        }

        &--middle-right {
            top: 50%;
            transform: translateY(-50%);
        }

        &--bottom-right {
            bottom: -1.5rem;
        }

        // ========================================
        // TABLET: Responsive Anpassungen
        // ========================================
        @media (min-width: 768px) {
            width: 55%;
            padding: 2rem 2.5rem;
            
            // Tablet: tan(25°) ≈ 0.4663 (mittlerer Winkel)
            --overlay-tangent: 0.4663;
            --overlay-max-offset: 120px;
            
            // Padding passt sich automatisch an via --overlay-corner-offset
            &--top-left,
            &--middle-left,
            &--bottom-left {
                padding-right: calc(2.5rem + var(--overlay-corner-offset));
            }
            
            &--top-right,
            &--middle-right,
            &--bottom-right {
                padding-left: calc(2.5rem + var(--overlay-corner-offset));
            }
            
            &--top-left,
            &--top-right {
                top: -2rem;
            }
            
            &--bottom-left,
            &--bottom-right {
                bottom: -2rem;
            }
        }

        // ========================================
        // DESKTOP: Größere Overlays, voller 33°-Winkel
        // ========================================
        @media (min-width: 1200px) {
            width: 50%;
            
            // Desktop: tan(33°) ≈ 0.6494 (voller Winkel)
            --overlay-tangent: 0.6494;
            --overlay-max-offset: 200px;
        }

        // ========================================
        // SCROLL ANIMATION - Initial State
        // ========================================
        &[data-overlay-animate]:not(.is-animated) {
            opacity: 0;
        }
        
        // Left positions: slide from left
        &--top-left[data-overlay-animate]:not(.is-animated),
        &--bottom-left[data-overlay-animate]:not(.is-animated) {
            transform: translateX(-120%);
        }
        
        &--middle-left[data-overlay-animate]:not(.is-animated) {
            transform: translateX(-120%) translateY(-50%);
        }

        // Right positions: slide from right
        &--top-right[data-overlay-animate]:not(.is-animated),
        &--bottom-right[data-overlay-animate]:not(.is-animated) {
            transform: translateX(120%);
        }
        
        &--middle-right[data-overlay-animate]:not(.is-animated) {
            transform: translateX(120%) translateY(-50%);
        }

        // ========================================
        // SCROLL ANIMATION - Animated State
        // ========================================
        &[data-overlay-animate].is-animated {
            opacity: 1;
        }
        
        &--top-left[data-overlay-animate].is-animated,
        &--bottom-left[data-overlay-animate].is-animated,
        &--top-right[data-overlay-animate].is-animated,
        &--bottom-right[data-overlay-animate].is-animated {
            transform: translateX(0);
        }
        
        &--middle-left[data-overlay-animate].is-animated,
        &--middle-right[data-overlay-animate].is-animated {
            transform: translateX(0) translateY(-50%);
        }
        
        // Fallback: Ohne data-overlay-animate immer sichtbar
        &:not([data-overlay-animate]) {
            opacity: 1;
        }
    }
    
    // ========================================
    // OVERLAY CONTENT
    // ========================================
    &__overlay-content {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    &__headline {
        margin: 0;
        font-family: 'Oswald', var(--sw-font-family-headline, sans-serif);
        font-size: 1.25rem;
        font-weight: 500;
        line-height: 1.3;
        text-transform: uppercase;
        color: inherit;
        
        @media (min-width: 768px) {
            font-size: 1.5rem;
        }
        
        @media (min-width: 1200px) {
            font-size: 1.65rem;
        }
    }
    
    &__text {
        margin: 0;
        font-size: 0.9rem;
        line-height: 1.3;
        color: inherit;
        
        p {
            margin: 0 0 0.5rem;
            color: inherit;
            
            &:last-child {
                margin-bottom: 0;
            }
        }
        
        @media (min-width: 768px) {
            font-size: 1.25rem;
        }
    }
}

// ============================================================================
// ACCESSIBILITY: Reduced Motion
// ============================================================================
@media (prefers-reduced-motion: reduce) {
    .cms-block-hero-image-overlay {
        &__overlay {
            transition: none;
            
            &[data-overlay-animate] {
                opacity: 1;
                transform: none !important;
                
                &.cms-block-hero-image-overlay__overlay--middle-left,
                &.cms-block-hero-image-overlay__overlay--middle-right {
                    transform: translateY(-50%) !important;
                }
            }
        }
    }
}

// ============================================================================
// PRINT STYLES
// ============================================================================
@media print {
    .cms-block-hero-image-overlay {
        min-height: 300px;
        
        &__image-wrapper {
            position: relative;
            height: 200px;
        }
        
        &__overlay {
            opacity: 1 !important;
            transform: none !important;
            position: relative;
            width: 100%;
            max-width: 100%;
            clip-path: none;
            padding: 1rem;
            margin-top: 1rem;
        }
    }
}
